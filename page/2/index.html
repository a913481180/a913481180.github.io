<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/1.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/1.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.baidu.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":false,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="KK">
<meta property="og:url" content="http://www.baidu.com/page/2/index.html">
<meta property="og:site_name" content="KK">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="KK">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://www.baidu.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>KK</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">KK</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.baidu.com/2022/01/11/20-22-22/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KK">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KK">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/11/20-22-22/" class="post-title-link" itemprop="url">Centos7安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-11 20:22:22" itemprop="dateCreated datePublished" datetime="2022-01-11T20:22:22+08:00">2022-01-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-23 15:54:26" itemprop="dateModified" datetime="2022-07-23T15:54:26+08:00">2022-07-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="could-not-retrieve-mirrorlist解决"><a href="#could-not-retrieve-mirrorlist解决" class="headerlink" title="could not retrieve mirrorlist解决"></a>could not retrieve mirrorlist解决</h3><p>在执行yum指令的时候出现这个问题,先尝试一下ping指令:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping 127.0.0.1</span><br><span class="line">ping www.baidu.com</span><br></pre></td></tr></table></figure>

<p>如果第一个正常,第二个错误,那就可能是你没有IP或者你没有启用联网功能;<br>没有IP就查查怎么配静态或者动态IP;<br><code>sudo vi /etc/sysconfig/network-scripts/ifcfg-ens33</code><br>修改配置<code>ONBOOT=no</code>—–&gt;<code>ONBOOT=yes</code><br>wq保存退出<br><code>service network restart</code>重启网络服务</p>
<p>如果你能ping通百度,还是报这个问题,这个就可能是你的DNS解析不了你的请求,修改DNS啊</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/resolv.conf</span><br><span class="line">nameserver 改成 8.8.8.8</span><br></pre></td></tr></table></figure>
<h3 id="启用ifconfig-命令"><a href="#启用ifconfig-命令" class="headerlink" title="启用ifconfig 命令"></a>启用ifconfig 命令</h3><p>依赖于 net-tools 软件</p>
<p><code> yum install -y net-tools</code></p>
<p>CentOS7最小化安装后没有wget软件，但是以后我们会经常用到这个组件，所以我们安装一下</p>
<p><code>yum install -y wget</code></p>
<h3 id="CentOS自带的国外源有时候会很慢，替换成国内的阿里源"><a href="#CentOS自带的国外源有时候会很慢，替换成国内的阿里源" class="headerlink" title="CentOS自带的国外源有时候会很慢，替换成国内的阿里源"></a>CentOS自带的国外源有时候会很慢，替换成国内的阿里源</h3><p>先进入源的目录<br><code>cd /etc/yum.repos.d </code><br>备份一下官方源<br><code>mv CentOS-Base.repo CentOS-Base.repo.bak </code><br>将阿里源文件下载下来<br><code>wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo </code><br>重建源数据缓存<br><code>yum clean all</code>     # 清除系统所有的yum缓存<br><code>yum makecache </code># 生成yum缓存<br>ok,换源完成</p>
<h3 id="在某些特定的情况下，执行-configure的时候会报错："><a href="#在某些特定的情况下，执行-configure的时候会报错：" class="headerlink" title="在某些特定的情况下，执行./configure的时候会报错："></a>在某些特定的情况下，执行./configure的时候会报错：</h3><p>error:newly created file is older than distributed files!<br>这是由于configure文件时间大于当前系统时间。</p>
<p>解决方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">方法一：</span><br><span class="line">cp configure configure_bak</span><br><span class="line">rm -f configure</span><br><span class="line">cp configure_bak configure</span><br><span class="line"></span><br><span class="line">方法二：修改当前系统时间</span><br><span class="line">hwclock --set --date=&quot;月/日/年 小时：分钟：秒钟&quot;</span><br><span class="line">hwclock --hctosys</span><br></pre></td></tr></table></figure>


<h3 id="一、正常的编译安装-卸载"><a href="#一、正常的编译安装-卸载" class="headerlink" title="一、正常的编译安装/卸载"></a>一、正常的编译安装/卸载</h3><p>源码的安装一般由3个步骤组成：配置(configure)、编译(make)、安装(make install)。<br>configure文件是一个可执行的脚本文件，它有很多选项，在待安装的源码目录下使用命令<code>./configure –help</code>可以输出详细的选项列表。</p>
<p>其中<code>--prefix</code>选项是配置安装目录，如果不配置该选项，安装后可执行文件默认放在<code>/usr/local/bin</code>，库文件默认放在<code>/usr/local/lib</code>，</p>
<p>配置文件默认放在<code>/usr/local/etc</code>，其它的资源文件放在<code>/usr/local/share</code>，比较凌乱。</p>
<p>如果配置了<code>--prefix</code>，如：</p>
<p><code>./configure --prefix=/usr/local/test</code><br>安装后的所有资源文件都会被放在<code>/usr/local/test</code>目录中，不会分散到其他目录。</p>
<p>使用<code>--prefix</code>选项的另一个好处是方便卸载软件或移植软件</p>
<p>当某个安装的软件不再需要时，只须简单的删除该安装目录，就可以把软件卸载干净；<br>移植软件只需拷贝整个目录到另外一个机器即可（相同的操作系统下）<br>当然要卸载程序，也可以在原来的<code>make</code>目录下用一次<code>make uninstall</code>，但前提是<code>Makefile</code>文件有<code>uninstall</code>命令。</p>
<h3 id="二、关于卸载"><a href="#二、关于卸载" class="headerlink" title="二、关于卸载"></a>二、关于卸载</h3><p>如果没有配置<code>--prefix</code>选项，源码包也没有提供<code>make uninstall</code>，则可以通过以下方式可以完整卸载：</p>
<p>一个临时目录重新安装一遍，如：</p>
<p>  <code>./configure --prefix=/tmp/to_remove &amp;&amp; make install</code><br>然后遍历<code>/tmp/to_remove</code>的文件，如vim的<code>/bin/vimdiff =&gt;find /usr/ -name vimdiff</code></p>
<p>删除对应安装位置的文件即可（因为<code>/tmp/to_remove</code>里的目录结构就是没有配置<code>--prefix</code>选项时的目录结构）。</p>
<h3 id="安装桌面"><a href="#安装桌面" class="headerlink" title="安装桌面"></a>安装桌面</h3><ol>
<li>yum 的 group 指令</li>
</ol>
<p>yum 可以以程序组的模式来安装成套的软件包。支持的软件包可以通过，对于 CentOS 6，Desktop、Desktop Platform、KDE Desktop、X Window System 是主要的桌面环境。对于 CentOS 7，有 KDE Plasma Workspaces 和 Gnome Desktop 两大桌面环境。</p>
<ol start="2">
<li>安装图形桌面环境</li>
</ol>
<p>CENTOS 7<br>CentOS 7 上的桌面环境安装包组合进行了调整，比以前要简单了。主要有两大阵营，KDE 和 GNOME。</p>
<p>因为没时间测试，只是预估着下面的指令应该能完成任务，请注意！</p>
<p>要安装 KDE 桌面环境（使用的是 Plasma 作为默认的桌面管理器了，很漂亮，看这里），</p>
<p>复制代码代码如下:<br><code># yum groupinstall &quot;KDE Plasma Workspaces&quot;</code></p>
<p>要安装 GNOME 环境，</p>
<p>复制代码代码如下:<br><code># yum groupinstall &quot;GNOME Desktop&quot;</code></p>
<p>安装程序会自动解决安装包和组件的依赖关系。</p>
<p>CENTOS 6<br>要安装 KDE 桌面环境，执行指令，</p>
<p>复制代码代码如下:<br><code># yum groupinstall &quot;X Window System&quot; &quot;KDE Desktop&quot; Desktop</code></p>
<p>即可，同时安装了 3 个软件包。注意，因为 KDE Desktop 和  X Window System 两个软件包名称中间都包含空格，需要用引号引起来才行。</p>
<p>要安装 Gnome 桌面环境，执行指令，</p>
<p>复制代码代码如下:<br><code># yum groupinstall &quot;X Window System&quot; &quot;Desktop Platform&quot; Desktop</code></p>
<p>即可，也是同时安装了 3 个软件包，其中 X Window System 是必须的，不管是 Gnome 还是 KDE。</p>
<p>既然是桌面环境，可能还需要诸如字体、管理工具之类的，如，</p>
<p>复制代码代码如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># yum -y groupinstall &quot;Graphical Administration Tools&quot;</span><br><span class="line"># yum -y groupinstall &quot;Internet Browser&quot;</span><br><span class="line"># yum -y groupinstall &quot;General Purpose Desktop&quot;</span><br><span class="line"># yum -y groupinstall &quot;Office Suite and Productivity&quot;</span><br><span class="line"># yum -y groupinstall &quot;Graphics Creation Tools&quot;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>启用</li>
</ol>
<p>从命令行直接启动图形桌面环境，</p>
<p><code># startx</code><br>这样就会启动默认的 Gnome 或者 KDE 桌面环境。如果有人喜欢同时安装 GNOME 和 KDE，切换方法可以参考 CentOS 文档。</p>
<p>如果希望启动时自动启动到图形桌面，需要修改启动配置。因为 CentOS 7 开始使用 systemd 管理器，其操作方式与之前版本有所不同。</p>
<p>CENTOS 7：<br>CentOS 7 中直接使用 systemd 指令修改启动目的状态即可。</p>
<p>使用，</p>
<p>复制代码代码如下:<br><code># systemctl get-default</code></p>
<p>可以查询到当前所设定的状态。multi-user.target 相当于以前的 level 3，也就是命令行终端；而 graphical.target 相当于以前的 level 5，也就是图形界面。</p>
<p>所以如果要设置默认启动到图形界面，则执行，</p>
<p>复制代码代码如下:<br><code># systemctl set-default graphical.target </code></p>
<p>CENTOS 6 等：<br>编辑 /etc/inittab，将 id:3:initdefault: 改为 id:5:initdefault:。（请注意这里的英文半角冒号。）参考这里。</p>
<p>直接用 sed 会很方便，</p>
<p>复制代码代码如下:<br><code>sed -i &#39;s/id:3:initdefault:/id:5:initdefault:/&#39; /etc/inittab</code></p>
<p>启动图形界面后，如果希望从图形界面切换到命令行界面，可以用 Ctrl + Alt + F6（实际上 F1 到 F6 都行，不过它们代表 Linux 中不同的控制台），或者反过来 Ctrl + Alt + F7 回到刚才的图形界面。</p>
<p>4.开机跳过图形化界面</p>
<p>复制代码代码如下:<br><code>#vi /etc/inittab--编辑/etc/inittab文件</code></p>
<p>找到下面语句：</p>
<p>复制代码代码如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Default runlevel. The runlevels used by RHS are:</span><br><span class="line"># 0 - halt (Do NOT set initdefault to this)--停机</span><br><span class="line"># 1 - Single user mode --单用户模式</span><br><span class="line"># 2 - Multiuser, without NFS (The same as 3, if you do not havenetworking) --多用户模式，不支持NFS</span><br><span class="line"># 3 - Full multiuser mode--多用户模式</span><br><span class="line"># 4 - unused--没有使用</span><br><span class="line"># 5 - X11--图形界面方式</span><br><span class="line"># 6 - reboot (Do NOT set initdefault to this)--重新启动</span><br><span class="line">#</span><br><span class="line">id:5:initdefault:--默认运行等级是5，只要将此处改成 id:3:initdefault:即可</span><br></pre></td></tr></table></figure>
<p>在文本模式想启动图形界面，可以打如下命令：</p>
<p>复制代码代码如下:<br><code>#startx</code></p>
<h2 id="CentOS离线状态下安装Python3-7-0"><a href="#CentOS离线状态下安装Python3-7-0" class="headerlink" title="CentOS离线状态下安装Python3.7.0"></a>CentOS离线状态下安装Python3.7.0</h2><ul>
<li><p>python安装包：Python-3.7.0</p>
</li>
<li><p>依赖安装包<br>zlib-devel　　　　　krb5-devel     　　　　ibselinux-devel<br>bzip2-devel　　　　openssl-devel　　　　ncurses-devel 　　　<br>sqlite-devel   　　　 readline-devel　　　  tk-devel<br>gdbm-devel     　　  db4-devel　　　　　   libpcap-devel 　　　　xz-devel     </p>
</li>
<li><p>解压python安装包: tar -xvJf  Python-3.7.0.tar.xz</p>
</li>
<li><p>编译安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/local/python3 # 创建编译安装目录</span><br><span class="line">cd Python-3.7.0　　　　　　# 进入python的解压目录</span><br><span class="line">./configure --prefix=/usr/local/python3</span><br><span class="line">make &amp;&amp; make install　　　# 编译$安装</span><br></pre></td></tr></table></figure></li>
<li><p>创建软连接</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/python3/bin/python3 /usr/local/bin/python3</span><br><span class="line">ln -s /usr/local/python3/bin/pip3 /usr/local/bin/pip3</span><br></pre></td></tr></table></figure>

<ul>
<li>验证是否安装成功<br>python3 -V<br>pip3 -V</li>
</ul>
<h2 id="CentOS7离线安装Nginx"><a href="#CentOS7离线安装Nginx" class="headerlink" title="CentOS7离线安装Nginx"></a>CentOS7离线安装Nginx</h2><ul>
<li>准备准备离线安装包</li>
</ul>
<p>openssl</p>
<p>zlib</p>
<p>pcre</p>
<p>nginx</p>
<ul>
<li><p>rpm -ivh *.rpm –nodeps –force</p>
</li>
<li><p>安装nginx</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">下载解压</span><br><span class="line"></span><br><span class="line">tar -xzvf  nginx-1.8.1.tar.gz</span><br><span class="line"></span><br><span class="line">cd  nginx-1.8.1</span><br><span class="line"></span><br><span class="line">./configure --prefix=/home/work/nginx</span><br><span class="line"></span><br><span class="line">编译并安装</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">运行nginx</span><br><span class="line">cd //home/work/nginx/sbin</span><br><span class="line">./nginx</span><br></pre></td></tr></table></figure>

<ul>
<li>防火墙<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel7 ~]# systemctl status firewalld.service</span><br><span class="line">[root@rhel7 ~]# systemctl stop firewalld.service</span><br><span class="line">[root@rhel7 ~]# systemctl disable firewalld.service</span><br><span class="line">[root@rhel7 ~]# systemctl status firewalld.service</span><br></pre></td></tr></table></figure></li>
<li>Nginx相关命令</li>
</ul>
<p>4.1 版本查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]# nginx  -v</span><br><span class="line">nginx version: nginx/1.12.2</span><br></pre></td></tr></table></figure>
<p>4.2 查看加载的模块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]# nginx -V</span><br><span class="line">nginx version: nginx/1.12.2</span><br><span class="line">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-28) (GCC) </span><br><span class="line">configure arguments: --add-module=/root/nginx-sticky-1.2.5/</span><br></pre></td></tr></table></figure>
<p>4.3 启停命令</p>
<p>4.3.1 启动</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx nginx-1.12.2]# nginx</span><br></pre></td></tr></table></figure>

<p>4.3.2 停止</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx nginx-1.12.2]# nginx -s stop</span><br><span class="line">[root@nginx nginx-1.12.2]# nginx -s quit</span><br></pre></td></tr></table></figure>

<p>4.3.3 动态加载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx nginx-1.12.2]# ngins -s reload</span><br></pre></td></tr></table></figure>

<p>4.3.4 测试配置文件nginx.conf正确性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]# nginx  -t</span><br><span class="line">nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful</span><br></pre></td></tr></table></figure>

<p><code>nginx -s stop</code>:此方式相当于先查出nginx进程id再使用kill命令强制杀掉进程。</p>
<p><code>nginx -s reload</code>:动态加载，当配置文件nginx.conf有变化时执行该命令动态加载。</p>
<p>4.4 开机自启动</p>
<p>编辑/etc/rc.d/rc.local文件，新增一行/usr/local/nginx/sbin/nginx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx rc.d]# cd /etc/rc.d</span><br><span class="line">[root@nginx rc.d]# sed -i &#x27;13a /usr/local/nginx/sbin/nginx&#x27; /etc/rc.d/rc.local </span><br><span class="line">[root@nginx rc.d]# chmod u+x rc.local</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.baidu.com/2021/12/22/23-33-33/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KK">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KK">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/22/23-33-33/" class="post-title-link" itemprop="url">uni-App</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-22 23:33:33" itemprop="dateCreated datePublished" datetime="2021-12-22T23:33:33+08:00">2021-12-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-26 22:37:23" itemprop="dateModified" datetime="2022-12-26T22:37:23+08:00">2022-12-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="uniApp"><a href="#uniApp" class="headerlink" title="uniApp"></a>uniApp</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul>
<li>配置浏览器目录</li>
<li>微信小程序-》设置-》安全设置-》打开多端口服务</li>
</ul>
<h2 id="尺寸单位"><a href="#尺寸单位" class="headerlink" title="尺寸单位"></a>尺寸单位</h2><ul>
<li><p>支持的通用 css 单位包括 px、rpx</p>
</li>
<li><p>px 即屏幕像素<br>rpx 即响应式 px，一种根据屏幕宽度自适应的动态单位。以 750 宽的屏幕为基准，750rpx 恰好为屏幕宽度。屏幕变宽，rpx 实际显示效果会等比放大，但在 App（vue2 不含 nvue） 端和 H5（vue2） 端屏幕宽度达到 960px 时，默认将按照 375px 的屏幕宽度进行计算，具体配置参考</p>
</li>
</ul>
<p>vue 页面支持下面这些普通 H5 单位，但在 nvue 里不支持：</p>
<p>rem 根字体大小可以通过 page-meta 配置<br>vh viewpoint height，视窗高度，1vh 等于视窗高度的 1%<br>vw viewpoint width，视窗宽度，1vw 等于视窗宽度的 1%<br>nvue 还不支持百分比单位。</p>
<p>App 端，在 pages.json 里的 titleNView 或页面里写的 plus api 中涉及的单位，只支持 px。注意此时不支持 rpx<br>nvue 中，uni-app 模式（nvue 不同编译模式介绍）可以使用 px 、rpx，表现与 vue 中基本一致，另外启用 dynamicRpx 后可以适配屏幕大小动态变化。weex 模式目前遵循 weex 的单位，它的单位比较特殊：</p>
<p>px:，以 750 宽的屏幕为基准动态计算的长度单位，与 vue 页面中的 rpx 理念相同。（一定要注意 weex 模式的 px，和 vue 里的 px 逻辑不一样。）<br>wx：与设备屏幕宽度无关的长度单位，与 vue 页面中的 px 理念相同<br>下面对 rpx 详细说明：</p>
<p>设计师在提供设计图时，一般只提供一个分辨率的图。</p>
<p>严格按设计图标注的 px 做开发，在不同宽度的手机上界面很容易变形。</p>
<p>而且主要是宽度变形。高度一般因为有滚动条，不容易出问题。由此，引发了较强的动态宽度单位需求。<br>rpx 是相对于基准宽度的单位，可以根据屏幕宽度进行自适应。uni-app 规定屏幕基准宽度 750rpx。</p>
<p>开发者可以通过设计稿基准宽度计算页面元素 rpx 值，设计稿 1px 与框架样式 1rpx 转换公式如下：</p>
<p>设计稿 1px / 设计稿基准宽度 = 框架样式 1rpx / 750rpx</p>
<p>换言之，页面元素宽度在 uni-app 中的宽度计算公式：</p>
<p>750 * 元素在设计稿中的宽度 / 设计稿基准宽度</p>
<p>举例说明：</p>
<p>若设计稿宽度为 750px，元素 A 在设计稿上的宽度为 100px，那么元素 A 在 uni-app 里面的宽度应该设为：750 _ 100 / 750，结果为：100rpx。<br>若设计稿宽度为 640px，元素 A 在设计稿上的宽度为 100px，那么元素 A 在 uni-app 里面的宽度应该设为：750 _ 100 / 640，结果为：117rpx。<br>若设计稿宽度为 375px，元素 B 在设计稿上的宽度为 200px，那么元素 B 在 uni-app 里面的宽度应该设为：750 * 200 / 375，结果为：400rpx。<br>Tips</p>
<p>注意 rpx 是和宽度相关的单位，屏幕越宽，该值实际像素越大。如不想根据屏幕宽度缩放，则应该使用 px 单位。<br>如果开发者在字体或高度中也使用了 rpx ，那么需注意这样的写法意味着随着屏幕变宽，字体会变大、高度会变大。如果你需要固定高度，则应该使用 px 。<br>rpx 不支持动态横竖屏切换计算，使用 rpx 建议锁定屏幕方向<br>设计师可以用 iPhone6 作为视觉稿的标准。<br>如果设计稿不是 750px，HBuilderX 提供了自动换算的工具，详见：HBuilderX 中自动转换 px 为 upx。<br>App 端，在 pages.json 里的 titleNView 或页面里写的 plus api 中涉及的单位，只支持 px，不支持 rpx。<br>早期 uni-app 提供了 upx ，目前已经推荐统一改为 rpx 了.</p>
<h2 id="选择器"><a href="#选择器" class="headerlink" title="选择器"></a>选择器</h2><p>目前支持的选择器有：<code>.class</code> <code>#id</code> <code>element</code> (<code>::after</code> <code>::before</code> )仅 vue 页面生效<br>注意：</p>
<p>在 uni-app 中不能使用 * 选择器。</p>
<p>微信小程序自定义组件中仅支持 class 选择器</p>
<p>page 相当于 body 节点，例如：</p>
<h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><p>uni-app 页面路由为框架统一管理，开发者需要在 pages.json 里配置每个路由页面的路径及页面样式。类似小程序在 app.json 中配置页面路由一样。所以 uni-app 的路由用法与 Vue Router 不同，如仍希望采用 Vue Router 方式管理路由，可在插件市场搜索 Vue-Router。</p>
<p>#路由跳转<br>uni-app 有两种页面路由跳转方式：使用 navigator 组件跳转、调用 API 跳转</p>
<p>|路由方式| 页面栈表现| 触发时机|<br>|初始化 |新页面入栈 uni-app 打开的第一个页面|<br>|打开新页面 |新页面入栈 |调用 API uni.navigateTo 、使用组件 <code>&lt;navigator open-type=&quot;navigate&quot;/&gt;</code>|<br>|页面重定向 |当前页面出栈，新页面入栈 |调用 API uni.redirectTo 、使用组件 <code>&lt;navigator open-type=&quot;redirectTo&quot;/&gt;</code>|<br>|页面返回 |页面不断出栈，直到目标返回页 |调用 API uni.navigateBack 、使用组件 <code>&lt;navigator open-type=&quot;navigateBack&quot;/&gt;</code> 、用户按左上角返回按钮、安卓用户点击物理 back 按键|<br>|Tab 切换 |页面全部出栈，只留下新的 Tab 页面 |调用 API uni.switchTab 、使用组件 <code>&lt;navigator open-type=&quot;switchTab&quot;/&gt;</code> 、用户切换 Tab|<br>|重加载 |页面全部出栈，只留下新的页面 |调用 API uni.reLaunch 、使用组件 <code>&lt;navigator open-type=&quot;reLaunch&quot;/&gt;</code>|</p>
<h2 id="pages-json-文件"><a href="#pages-json-文件" class="headerlink" title="pages.json 文件"></a>pages.json 文件</h2><p>pages.json 文件用来对 uni-app 进行全局配置，决定页面文件的路径、窗口样式、原生的导航栏、底部的原生tabbar 等。</p>
<p>它类似微信小程序中app.json的页面管理部分。注意定位权限申请等原属于app.json的内容，在uni-app中是在manifest中配置。</p>
<h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h2><p>-</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.baidu.com/2021/12/01/10-12-33/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KK">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KK">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/01/10-12-33/" class="post-title-link" itemprop="url">Three.js</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-01 10:12:33" itemprop="dateCreated datePublished" datetime="2021-12-01T10:12:33+08:00">2021-12-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-06 11:30:12" itemprop="dateModified" datetime="2023-02-06T11:30:12+08:00">2023-02-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index"><span itemprop="name">web</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Threejs"><a href="#Threejs" class="headerlink" title="Threejs"></a>Threejs</h1><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><h3 id="创建一个场景"><a href="#创建一个场景" class="headerlink" title="创建一个场景"></a>创建一个场景</h3><p>场景、相机和渲染器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const scene = new THREE.Scene();</span><br><span class="line">const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );</span><br><span class="line"></span><br><span class="line">const renderer = new THREE.WebGLRenderer();</span><br><span class="line">renderer.setSize( window.innerWidth, window.innerHeight );</span><br><span class="line">document.body.appendChild( renderer.domElement );</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>相机：<br>three.js里有几种不同的相机，在这里，我们使用的是PerspectiveCamera（透视摄像机）。</li>
</ul>
<p>第一个参数是视野角度（FOV）。视野角度就是无论在什么时候，你所能在显示器上看到的场景的范围，它的单位是角度(与弧度区分开)。</p>
<p>第二个参数是长宽比（aspect ratio）。 也就是你用一个物体的宽除以它的高的值。比如说，当你在一个宽屏电视上播放老电影时，可以看到图像仿佛是被压扁的。</p>
<p>接下来的两个参数是近截面（near）和远截面（far）。 当物体某些部分比摄像机的远截面远或者比近截面近的时候，该这些部分将不会被渲染到场景中。或许现在你不用担心这个值的影响，但未来为了获得更好的渲染性能，你将可以在你的应用程序里去设置它。</p>
<ul>
<li>渲染器：<br>除了创建一个渲染器的实例之外，我们还需要在我们的应用程序里设置一个渲染器的尺寸。比如说，我们可以使用所需要的渲染区域的宽高，来让渲染器渲染出的场景填充满我们的应用程序。因此，我们可以将渲染器宽高设置为浏览器窗口宽高。对于性能比较敏感的应用程序来说，你可以使用setSize传入一个较小的值，例如window.innerWidth/2和window.innerHeight/2，这将使得应用程序在渲染时，以一半的长宽尺寸渲染场景。</li>
</ul>
<p>如果你希望保持你的应用程序的尺寸，但是以较低的分辨率来渲染，你可以在调用setSize时，将updateStyle（第三个参数）设为false。例如，假设你的<canvas> 标签现在已经具有了100%的宽和高，调用setSize(window.innerWidth/2, window.innerHeight/2, false)将使得你的应用程序以一半的分辨率来进行渲染。</p>
<h3 id="创建一个立方体"><a href="#创建一个立方体" class="headerlink" title="创建一个立方体"></a>创建一个立方体</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const geometry = new THREE.BoxGeometry();</span><br><span class="line">const material = new THREE.MeshBasicMaterial( &#123; color: 0x00ff00 &#125; );</span><br><span class="line">const cube = new THREE.Mesh( geometry, material );</span><br><span class="line">scene.add( cube );</span><br><span class="line"></span><br><span class="line">camera.position.z = 5;</span><br></pre></td></tr></table></figure>
<p>创建一个立方体，我们需要一个BoxGeometry（立方体）对象. 这个对象包含了一个立方体中所有的顶点（vertices）和面（faces）。接下来，对于这个立方体，我们需要给它一个材质，来让它有颜色。第三步，我们需要一个Mesh（网格）。 网格包含一个几何体以及作用在此几何体上的材质，我们可以直接将网格对象放入到我们的场景中，并让它在场景中自由移动。</p>
<h3 id="渲染场景"><a href="#渲染场景" class="headerlink" title="渲染场景"></a>渲染场景</h3><p>现在，如果将之前写好的代码复制到HTML文件中，你不会在页面中看到任何东西。这是因为我们还没有对它进行真正的渲染。为此，我们需要使用一个被叫做“渲染循环”（render loop）或者“动画循环”（animate loop）的东西。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function animate() &#123;</span><br><span class="line">	requestAnimationFrame( animate );</span><br><span class="line">	renderer.render( scene, camera );</span><br><span class="line">&#125;</span><br><span class="line">animate();</span><br></pre></td></tr></table></figure>
<p>在这里我们创建了一个使渲染器能够在每次屏幕刷新时对场景进行绘制的循环（在大多数屏幕上，刷新率一般是60次/秒）。如果你是一个浏览器游戏开发的新手，你或许会说“为什么我们不直接用setInterval来实现刷新的功能呢？”当然啦，我们的确可以用setInterval，但是，requestAnimationFrame有很多的优点。最重要的一点或许就是当用户切换到其它的标签页时，它会暂停，因此不会浪费用户宝贵的处理器资源，也不会损耗电池的使用寿命。</p>
<h2 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h2><h3 id="相机"><a href="#相机" class="headerlink" title="相机"></a>相机</h3><ul>
<li><p>摄像机阵列（ArrayCamera）<br>ArrayCamera 用于更加高效地使用一组已经预定义的摄像机来渲染一个场景。这将能够更好地提升VR场景的渲染性能。<br>一个 ArrayCamera 的实例中总是包含着一组子摄像机，应当为每一个子摄像机定义viewport（视口）这个属性，这一属性决定了由该子摄像机所渲染的视口区域的大小。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const cameras = [];</span><br><span class="line">     for (let i = 1; i &lt; 4; i++) &#123;</span><br><span class="line">       const subcamera = new THREE.PerspectiveCamera(40, 1, 0.1, 10);</span><br><span class="line">       subcamera.viewport = new THREE.Vector4(</span><br><span class="line">         Math.floor(i * 200),</span><br><span class="line">         Math.floor(1 * 200), //视口高</span><br><span class="line">         Math.ceil(200), //宽</span><br><span class="line">         Math.ceil(200) //视口高</span><br><span class="line">       );</span><br><span class="line">       subcamera.position.x = i / 3 - 0.5;</span><br><span class="line">       subcamera.position.y = 0.5 + i;</span><br><span class="line">       subcamera.position.z = 1.5;</span><br><span class="line">       subcamera.position.multiplyScalar(2);</span><br><span class="line">       subcamera.lookAt(0, 0, 0);</span><br><span class="line">       subcamera.updateMatrixWorld();</span><br><span class="line">       cameras.push(subcamera);</span><br><span class="line">     &#125;</span><br><span class="line">     let camera = new THREE.ArrayCamera(cameras);</span><br></pre></td></tr></table></figure></li>
<li><p>立方相机（CubeCamera）<br>创建6个渲染到WebGLCubeRenderTarget的摄像机<br>构造器<br>CubeCamera( near : Number, far : Number, renderTarget : WebGLCubeRenderTarget )<br>near – 近剪切面的距离<br>far – 远剪切面的距离<br>renderTarget – The destination cube render target.</p>
</li>
</ul>
<p>构造一个包含6个PerspectiveCameras（透视摄像机）的立方摄像机， 并将其拍摄的场景渲染到一个WebGLCubeRenderTarget上。</p>
<ul>
<li>正交相机（OrthographicCamera）<br>这一摄像机使用orthographic projection（正交投影）来进行投影。</li>
</ul>
<p>在这种投影模式下，无论物体距离相机距离远或者近，在最终渲染的图片中物体的大小都保持不变。</p>
<p>这对于渲染2D场景或者UI元素是非常有用的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const camera = new THREE.OrthographicCamera( width / - 2, width / 2, height / 2, height / - 2, 1, 1000 );</span><br><span class="line">scene.add( camera );</span><br></pre></td></tr></table></figure>
<p>构造器<br>OrthographicCamera( left : Number, right : Number, top : Number, bottom : Number, near : Number, far : Number )<br>left — 摄像机视锥体左侧面。<br>right — 摄像机视锥体右侧面。<br>top — 摄像机视锥体上侧面。<br>bottom — 摄像机视锥体下侧面。<br>near — 摄像机视锥体近端面。<br>far — 摄像机视锥体远端面。</p>
<ul>
<li>透视相机（PerspectiveCamera）<br>这一摄像机使用perspective projection（透视投影）来进行投影。</li>
</ul>
<p>这一投影模式被用来模拟人眼所看到的景象，它是3D场景的渲染中使用得最普遍的投影模式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const camera = new THREE.PerspectiveCamera( 45, width / height, 1, 1000 );</span><br><span class="line">scene.add( camera );</span><br></pre></td></tr></table></figure>
<p>构造器<br>PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )<br>fov — 摄像机视锥体垂直视野角度<br>aspect — 摄像机视锥体长宽比<br>near — 摄像机视锥体近端面<br>far — 摄像机视锥体远端面</p>
<ul>
<li>立体相机（StereoCamera）<br>双透视摄像机（立体相机）常被用于创建3D Anaglyph（3D立体影像） 或者Parallax Barrier（视差屏障）。</li>
</ul>
<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><h3 id="Scene"><a href="#Scene" class="headerlink" title="Scene"></a>Scene</h3><h4 id="构造器"><a href="#构造器" class="headerlink" title="构造器"></a>构造器</h4><p>Scene()<br>创建一个新的场景对象。</p>
<h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><ul>
<li><p>.autoUpdate : Boolean<br>默认值为true，若设置了这个值，则渲染器会检查每一帧是否需要更新场景及其中物体的矩阵。 当设为false时，你必须亲自手动维护场景中的矩阵。</p>
</li>
<li><p>.background : Object<br>若不为空，在渲染场景的时候将设置背景，且背景总是首先被渲染的。 可以设置一个用于的“clear”的Color（颜色）、一个覆盖canvas的Texture（纹理）， 或是 a cubemap as a CubeTexture or an equirectangular as a Texture。默认值为null。<br><code>scene.background = new THREE.Color( 0xbfe3dd );</code></p>
</li>
<li><p>.environment : Texture<br>若该值不为null，则该纹理贴图将会被设为场景中所有物理材质的环境贴图。 然而，该属性不能够覆盖已存在的、已分配给 MeshStandardMaterial.envMap 的贴图。默认为null。<br><code>scene.environment = pmremGenerator.fromScene( new RoomEnvironment(), 0.04 ).texture;</code></p>
</li>
<li><p>.overrideMaterial : Material<br>如果不为空，它将强制场景中的每个物体使用这里的材质来渲染。默认值为null。</p>
</li>
<li><p>.fog : Fog<br>一个fog实例定义了影响场景中的每个物体的雾的类型。默认值为null。<br><code>scene.fog=new THREE.FogExp2( 0xefd1b5, 0.0025 );</code></p>
</li>
</ul>
<h3 id="雾（Fog）"><a href="#雾（Fog）" class="headerlink" title="雾（Fog）"></a>雾（Fog）</h3><p>这个类中的参数定义了线性雾。也就是说，雾的密度是随着距离线性增大的。</p>
<h4 id="构造器-1"><a href="#构造器-1" class="headerlink" title="构造器"></a>构造器</h4><p>Fog( color : Integer, near : Float, far : Float )<br>颜色参数传入Color构造函数中，来设置颜色属性。颜色可以是一个十六进制的整型数，或者是CSS风格的字符串。</p>
<h4 id="属性-1"><a href="#属性-1" class="headerlink" title="属性"></a>属性</h4><ul>
<li><p>.name : String<br>对象的名称，可选、不必唯一。默认值是一个空字符串。</p>
</li>
<li><p>.color : Color<br>雾的颜色。比如说，如果将其设置为黑色，远处的物体将被渲染成黑色。</p>
</li>
<li><p>.near : Float<br>开始应用雾的最小距离。距离小于活动摄像机“near”个单位的物体将不会被雾所影响。<br>默认值是1。</p>
</li>
<li><p>.far : Float<br>结束计算、应用雾的最大距离，距离大于活动摄像机“far”个单位的物体将不会被雾所影响。<br>默认值是1000。</p>
</li>
</ul>
<h3 id="雾-指数（FogExp2）"><a href="#雾-指数（FogExp2）" class="headerlink" title="雾-指数（FogExp2）"></a>雾-指数（FogExp2）</h3><p>该类所包含的参数定义了指数雾，它可以在相机附近提供清晰的视野，且距离相机越远，雾的浓度随着指数增长越快。</p>
<h4 id="构造器-2"><a href="#构造器-2" class="headerlink" title="构造器"></a>构造器</h4><p>FogExp2( color : Integer, density : Float )<br>颜色参数传入Color构造函数中，来设置颜色属性。颜色可以是一个十六进制的整型数，或者是CSS风格的字符串。</p>
<h4 id="属性-2"><a href="#属性-2" class="headerlink" title="属性"></a>属性</h4><ul>
<li><p>.name : String<br>对象的名称，可选、不必唯一。默认值是一个空字符串。</p>
</li>
<li><p>.color : Color<br>雾的颜色。比如说，如果将其设置为黑色，远处的物体将被渲染成黑色。</p>
</li>
<li><p>.density : Float<br>定义雾的密度将会增长多块。<br>默认值是0.00025.</p>
</li>
</ul>
<h2 id="全屏"><a href="#全屏" class="headerlink" title="全屏"></a>全屏</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">window.addEventListener(&#x27;dblclick&#x27;,()=&gt;&#123;</span><br><span class="line"></span><br><span class="line">  let isFull=document.fullscreenElement;</span><br><span class="line">  if(!isFull)&#123;</span><br><span class="line">    renderer.domElement.requestFullscreen(); </span><br><span class="line">  &#125;else&#123;</span><br><span class="line"></span><br><span class="line">    document.exitFullscreen(); </span><br><span class="line">  &#125;else&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="自适应屏幕"><a href="#自适应屏幕" class="headerlink" title="自适应屏幕"></a>自适应屏幕</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">window.addEventListener(&#x27;resize&#x27;,()=&gt;&#123;</span><br><span class="line">  //更新摄像头</span><br><span class="line">  camera.aspect=window.innerWidth/window.innerHeight</span><br><span class="line">  //更新摄像机投影矩阵</span><br><span class="line">  camera.updateProjectionMatrix();</span><br><span class="line">  //更新渲染器</span><br><span class="line">  renderer.setSize(window.innerWidth,window.innerHeight)</span><br><span class="line">  //设置渲染器的像素比</span><br><span class="line">  renderer.setPixelRatio(window.devicePixelRatio)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.baidu.com/2021/12/01/10-12-33/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KK">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KK">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/01/10-12-33/" class="post-title-link" itemprop="url">MySql</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-01 10:12:33" itemprop="dateCreated datePublished" datetime="2021-12-01T10:12:33+08:00">2021-12-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-09-14 21:38:01" itemprop="dateModified" datetime="2022-09-14T21:38:01+08:00">2022-09-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index"><span itemprop="name">web</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MySql"><a href="#MySql" class="headerlink" title="MySql"></a>MySql</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul>
<li>MySQL 官网下载最新版<code>https://dev.mysql.com/downloads/installer/</code></li>
<li>然后在 cmd 里面 cd 到<code>D:\mysql-8.0.11</code>安装目录</li>
<li>在该文件夹下创建 my.ini 配置文件编辑 my.ini 配置以下基本信息</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line"># 设置mysql客户端默认字符集</span><br><span class="line">default-character-set=utf8</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"># 设置3306端口</span><br><span class="line">port = 3306</span><br><span class="line"># 设置mysql的安装目录</span><br><span class="line">basedir=C:\\web\\mysql-8.0.11</span><br><span class="line"># 设置 mysql数据库的数据的存放目录MySQL 8+ 不需要以下配置，系统自己生成即可否则有可能报错</span><br><span class="line"># datadir=C:\\web\\sqldata</span><br><span class="line"># 允许最大连接数</span><br><span class="line">max_connections=20</span><br><span class="line"># 服务端使用的字符集默认为8比特编码的latin1字符集</span><br><span class="line">character-set-server=utf8</span><br><span class="line"># 创建新表时将使用的默认存储引擎</span><br><span class="line">default-storage-engine=INNODB</span><br></pre></td></tr></table></figure>

<blockquote>
<p>MySQL 数据库进行初始化命令操作时提示 my.ini 配置文件错误的解决方法<br>通过修改 MySQL 数据库中 my.ini 配置文件编码格式的方法解决此问题。<br>步骤：用记事本打开 my.ini 文件——》点击“文件”选择“另存为”——》将编码选为 ANSI——》保存覆盖——》重启 MySQL 。</p>
</blockquote>
<ul>
<li>以管理员身份打开 cmd 命令行工具切换目录<code>cd D:\mysql-8.0.11\bin</code></li>
<li>初始化数据库<code>mysqld --initialize --console</code>执行完成后会输出 root 用户的初始默认密码!!!!</li>
<li>安装<code>mysqld install</code></li>
<li>启动输入以下命令<code>net start mysql</code></li>
<li>停止<code>net stop mysql</code></li>
<li>登录 MySQL<code>mysql -u root -p</code></li>
<li>修改初始密码<code>ALTER USER USER() IDENTIFIED BY &#39;123456&#39;;</code></li>
</ul>
<h3 id="mysql-数据类型"><a href="#mysql-数据类型" class="headerlink" title="mysql 数据类型"></a>mysql 数据类型</h3><table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>整数类型</td>
<td>tinyint\smallint\mediumint\int\bigint</td>
</tr>
<tr>
<td>浮点小数类型</td>
<td>float\double</td>
</tr>
<tr>
<td>定点小数类型</td>
<td>decimal</td>
</tr>
<tr>
<td>时间、日期类型</td>
<td>year\time\date\datetime\timestamp</td>
</tr>
<tr>
<td>文本字符串</td>
<td>char\varchar\tinytext\text\mediumtext\longtext\enum\set</td>
</tr>
<tr>
<td>二进制字符串</td>
<td>bit\binary\varbinary\tinyblob\blog\mediumblob\longblob</td>
</tr>
</tbody></table>
<blockquote>
<p>char(n)和 varchar(n)中括号中 n 代表字符的个数并不代表字节个数比如 CHAR(30)就可以存储 30 个字符。</p>
</blockquote>
<h3 id="mysql-常用语句"><a href="#mysql-常用语句" class="headerlink" title="mysql 常用语句"></a>mysql 常用语句</h3><blockquote>
<p>不区分大小写</p>
</blockquote>
<table>
<thead>
<tr>
<th>语句</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>use xxx;</td>
<td>选择数据库</td>
</tr>
<tr>
<td>show databases;</td>
<td>显示数据库</td>
</tr>
<tr>
<td>show columns from customers;</td>
<td>获取 customers 表的一个列</td>
</tr>
<tr>
<td>CREATE DATABASE xxx;</td>
<td>创建数据库</td>
</tr>
<tr>
<td>drop database xxxx;</td>
<td>删除数据库</td>
</tr>
<tr>
<td>show create database xxxx;</td>
<td>查看数据库信息</td>
</tr>
<tr>
<td>alter database 库名 选项信息;</td>
<td>修改库信息</td>
</tr>
<tr>
<td>CREATE TABLE table_name (column_name column_type,….);</td>
<td>创建表</td>
</tr>
<tr>
<td>show tables;</td>
<td>查看所有表</td>
</tr>
<tr>
<td>show tables from xxx;</td>
<td>查看所有表</td>
</tr>
<tr>
<td>ALTER TABLE 表名 表的选项</td>
<td>修改表信息</td>
</tr>
<tr>
<td>RENAME TABLE 原表名 TO 新表名</td>
<td>对表进行重命名</td>
</tr>
<tr>
<td>RENAME TABLE 原表名 TO 库名.表名</td>
<td>可将表移动到另一个数据库</td>
</tr>
<tr>
<td>ALTER TABLE 表名 操作名</td>
<td>操作名:<code>ADD[ COLUMN] 字段名</code>– 增加字段;<code>AFTER 字段名</code>– 表示增加在该字段名后面;<code>FIRST</code>– 表示增加在第一个;<code>ADD PRIMARY KEY(字段名)</code>– 创建主键; <code>ADD UNIQUE [索引名] (字段名)</code>– 创建唯一索引;<code>ADD INDEX [索引名] (字段名)</code>– 创建普通索引;<code>DROP[ COLUMN] 字段名</code>– 删除字段;<code>MODIFY[ COLUMN] 字段名 字段属性</code>– 支持对字段属性进行修改不能修改字段名(所有原有属性也需写上);<code>CHANGE[ COLUMN] 原字段名 新字段名 字段属性</code>– 支持对字段名修改;<code>DROP PRIMARY KEY</code>– 删除主键(删除主键前需删除其 AUTO_INCREMENT 属性);<code>DROP INDEX 索引名</code>– 删除索引;<code>DROP FOREIGN KEY 外键</code> – 删除外键;</td>
</tr>
<tr>
<td>DROP TABLE[ IF EXISTS] 表名</td>
<td>删除表</td>
</tr>
<tr>
<td>TRUNCATE [TABLE] 表名</td>
<td>清空表</td>
</tr>
</tbody></table>
<blockquote>
<p>对于字段的定义<br>字段名 数据类型 [NOT NULL | NULL] [DEFAULT default_value] [AUTO_INCREMENT] [UNIQUE [KEY] | [PRIMARY] KEY] [COMMENT ‘string’]<br>– 表选项</p>
</blockquote>
<pre><code>-- 字符集
    CHARSET = charset_name
    如果表没有设定则使用数据库字符集
-- 存储引擎
    ENGINE = engine_name
    表在管理数据时采用的不同的数据结构结构不同会导致处理方式、提供的特性操作等不同
    常见的引擎InnoDB MyISAM Memory/Heap BDB Merge Example CSV MaxDB Archive
    不同的引擎在保存表的结构和数据时采用不同的方式
    MyISAM表文件含义.frm表定义.MYD表数据.MYI表索引
    InnoDB表文件含义.frm表定义表空间数据和日志文件
    SHOW ENGINES -- 显示存储引擎的状态信息
    SHOW ENGINE 引擎名 &#123;LOGS|STATUS&#125; -- 显示存储引擎的日志或状态信息
-- 数据文件目录
    DATA DIRECTORY = &#39;目录&#39;
-- 索引文件目录
    INDEX DIRECTORY = &#39;目录&#39;
-- 表注释
    COMMENT = &#39;string&#39;
-- 分区选项
    PARTITION BY ... (详细见手册)
</code></pre>
<p>/_ 列属性列约束 _/</p>
<ol>
<li>主键</li>
</ol>
<ul>
<li>能唯一标识记录的字段可以作为主键。</li>
<li>一个表只能有一个主键。</li>
<li>主键具有唯一性。</li>
<li>声明字段时用 primary key 标识。<br>也可以在字段列表之后声明</li>
</ul>
<p>例 create table tab ( id int, stu varchar(10), primary key (id));</p>
<ul>
<li>主键字段的值不能为 null。</li>
<li>主键可以由多个字段共同组成。此时需要在字段列表后声明的方法。</li>
</ul>
<p>例 create table tab ( id int, stu varchar(10), age int, primary key (stu, age));</p>
<ol start="2">
<li>unique 唯一索引唯一约束</li>
</ol>
<p>使得某字段的值也不能重复。</p>
<ol start="3">
<li><p>null 约束</p>
<p>null 不是数据类型是列的一个属性。<br>表示当前列是否可以为 null 表示什么都没有。<br>null, 允许为空。默认。<br>not null, 不允许为空。<br>insert into tab values (null, ‘val’);<br>– 此时表示将第一个字段的值设为 null, 取决于该字段是否允许为 null</p>
</li>
<li><p>default 默认值属性</p>
</li>
</ol>
<p>当前字段的默认值。<br>insert into tab values (default, ‘val’); – 此时表示强制使用默认值。<br>create table tab ( add_time timestamp default current_timestamp );<br>– 表示将当前时间的时间戳设为默认值。<br>current_date, current_time</p>
<ol start="5">
<li>auto_increment 自动增长约束</li>
</ol>
<p>自动增长必须为索引主键或 unique</p>
<p>只能存在一个字段为自动增长。</p>
<p>默认为 1 开始自动增长。可以通过表属性 auto_increment = x 进行设置或 alter table tbl auto_increment = x;</p>
<ol start="6">
<li>comment 注释</li>
</ol>
<p>例：create table tab ( id int ) comment ‘注释内容’;</p>
<ol start="7">
<li>foreign key 外键约束</li>
</ol>
<p>用于限制主表与从表数据完整性。</p>
<p>alter table t1 add constraint <code>t1_t2_fk</code> foreign key (t1_id) references t2(id);<br>– 将表 t1 的 t1_id 外键关联到表 t2 的 id 字段。<br>– 每个外键都有一个名字可以通过 constraint 指定</p>
<p>存在外键的表称之为从表子表外键指向的表称之为主表父表。</p>
<p>作用保持数据一致性完整性主要目的是控制存储在外键表从表中的数据。</p>
<p>MySQL 中可以对 InnoDB 引擎使用外键约束</p>
<p>语法</p>
<p>foreign key (外键字段 references 主表名 (关联字段) [主表记录删除时的动作] [主表记录更新时的动作]</p>
<p>此时需要检测一个从表的外键需要约束为主表的已存在的值。外键在没有关联的情况下可以设置为 null.前提是该外键列没有 not null。</p>
<p>可以不指定主表记录更改或更新时的动作那么此时主表的操作被拒绝。</p>
<p>如果指定了 on update 或 on delete 在删除或更新时有如下几个操作可以选择</p>
<ol>
<li><p>cascade 级联操作。主表数据被更新主键值更新从表也被更新外键值更新。主表记录被删除从表相关记录也被删除。</p>
</li>
<li><p>set null 设置为 null。主表数据被更新主键值更新从表的外键被设置为 null。主表记录被删除从表相关记录外键被设置成 null。但注意要求该外键列没有 not null 属性约束。</p>
</li>
<li><p>restrict 拒绝父表删除和更新。</p>
</li>
</ol>
<p>注意外键只被 InnoDB 存储引擎所支持。其他引擎是不支持的。</p>
<h3 id="增删查改"><a href="#增删查改" class="headerlink" title="增删查改"></a>增删查改</h3><ul>
<li>创建表</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS `runoob_tbl`(</span><br><span class="line">   `runoob_id` INT UNSIGNED AUTO_INCREMENT,</span><br><span class="line">   `runoob_title` VARCHAR(100) NOT NULL,</span><br><span class="line">   `runoob_author` VARCHAR(40) NOT NULL,</span><br><span class="line">   `submission_date` DATE,</span><br><span class="line">   PRIMARY KEY ( `runoob_id` )</span><br><span class="line">)ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>

<ul>
<li>增</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">INSERT [INTO] 表名 [(字段列表)] VALUES (值列表)[, (值列表), ...]</span><br><span class="line">        -- 如果要插入的值列表包含所有字段并且顺序一致，则可以省略字段列表。</span><br><span class="line">        -- 可同时插入多条数据记录！</span><br><span class="line">        REPLACE 与 INSERT 完全一样，可互换。</span><br><span class="line">INSERT [INTO] 表名 SET 字段名=值[, 字段名=值, ...]</span><br></pre></td></tr></table></figure>

<ul>
<li>查</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT column_name,column_name</span><br><span class="line">FROM table_name</span><br><span class="line">[WHERE Clause]</span><br><span class="line">[LIMIT N][ OFFSET M]</span><br><span class="line">        -- 可来自多个表的多个字段</span><br><span class="line">        -- 其他子句可以不使用</span><br><span class="line">        -- 字段列表可以用*代替表示所有字段</span><br><span class="line">        你可以使用 LIMIT 属性来设定返回的记录数。</span><br><span class="line">你可以通过OFFSET指定SELECT语句开始查询的数据偏移量。默认情况下偏移量为0。</span><br></pre></td></tr></table></figure>

<ul>
<li>删</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM 表名[ 删除条件子句]</span><br><span class="line"></span><br><span class="line">没有条件子句则会删除全部</span><br></pre></td></tr></table></figure>

<ul>
<li>改</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UPDATE table_name SET field1=new-value1, field2=new-value2</span><br><span class="line">[WHERE Clause]</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * from runoob_tbl WHERE runoob_id=3;</span><br></pre></td></tr></table></figure>

<ul>
<li>WHERE 子句</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">   SELECT field1, field2,...fieldN FROM table_name1, table_name2...</span><br><span class="line">[WHERE condition1 [AND [OR]] condition2.....</span><br></pre></td></tr></table></figure>

<blockquote>
<p>MySQL 的 WHERE 子句的字符串比较是不区分大小写的。 你可以使用 BINARY 关键字来设定 WHERE 子句的字符串比较是区分大小写的。</p>
</blockquote>
<p><code>mysql&gt; SELECT * from runoob_tbl WHERE BINARY runoob_author=&#39;RUNOOB.COM&#39;;</code></p>
<ul>
<li>LIKE 子句</li>
</ul>
<blockquote>
<p>LIKE 子句中使用百分号 %字符来表示任意字符类似于 UNIX 或正则表达式中的星号 *。如果没有使用百分号 %, LIKE 子句与等号= 的效果是一样的。</p>
</blockquote>
<p><code>mysql&gt; SELECT * from runoob_tbl WHERE runoob_author LIKE &#39;%COM&#39;;</code></p>
<h3 id="nodejs-连接数据库"><a href="#nodejs-连接数据库" class="headerlink" title="nodejs 连接数据库"></a>nodejs 连接数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">client does not support authentication protocol requested by server</span><br><span class="line">//出现连接失败的原因mysql8之前的版本中加密规则是mysql_native_password,而在mysql8之后,加密规则是caching_sha2_password。并提供了两种解决方案</span><br><span class="line">//把用户密码登录的加密规则还原成mysql_native_password这种加密方式</span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;password&#x27; PASSWORD EXPIRE NEVER;这里的password是你正在使用的密码</span><br></pre></td></tr></table></figure>

<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD<br>方式1：直接使用数据库提供的SQL语句<br>=======</p>
<h3 id="MySQL-分页查询的-5-种方法"><a href="#MySQL-分页查询的-5-种方法" class="headerlink" title="MySQL 分页查询的 5 种方法"></a>MySQL 分页查询的 5 种方法</h3><blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>3c5cfeb51abb6cea4e5e0de711a8fed595408289</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<p>方式 1：</p>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD<br>适应场景: 适用于数据量较少的情况(元组百/千级)。很简单，该语句的意思就是查询m+n条记录，去掉前m条，返回后n条。无疑该查询能够实现分页，但m越大，查询性能就越低，因为MySQL需要扫描全部m+n条记录。</p>
<h1 id="方式2：基于索引再排序"><a href="#方式2：基于索引再排序" class="headerlink" title="方式2：基于索引再排序"></a>方式2：基于索引再排序</h1><p>select * from table order by id limit m, n;</p>
<p>很简单，该语句的意思就是查询 m+n 条记录，去掉前 m 条，返回后 n 条。无疑该查询能够实现分页，但 m 越大，查询性能就越低，因为 MySQL 需要扫描全部 m+n 条记录。</p>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>3c5cfeb51abb6cea4e5e0de711a8fed595408289</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<p>方式 2：</p>
<p>select * from table where id &gt; #max_id# order by id limit n;</p>
<p>该查询同样会返回后 n 条记录，却无需像方式 1 扫描前 m 条记录，但必须在每次查询时拿到上一次查询（上一页）的最大 id（或最小 id），是比较常用的方式。</p>
<p>当然该查询的问题也在于我们不一定能拿到这个 id，比如当前在第 3 页，需要查询第 5 页的数据，就不行了。</p>
<p>方式 3：</p>
<p>为了避免方式 2 不能实现的跨页查询，就需要结合方式 1。</p>
<p>性能需要，m 得尽量小。比如当前在第 3 页，需要查询第 5 页，每页 10 条数据，且当前第 3 页的最大 id 为#max_id#，则：</p>
<p>select * from table where id &gt; #max_id# order by id limit 10, 10;</p>
<p>该方式就部分解决了方式 2 的问题，但如果当前在第 2 页，要查第 1000 页，性能仍然较差。</p>
<p>方式 4：</p>
<p>select * from table as a inner join (select id from table order by id limit m, n) as b on a.id = b.id order by a.id;</p>
<p>该查询同方式 1 一样，m 的值可能很大，但由于内部的子查询只扫描了 id 字段，而非全表，所以性能要强于方式 1，并且能够解决跨页查询问题。</p>
<p>方式 5：</p>
<p>select * from table where id &gt; (select id from table order by id limit m, 1) limit n;</p>
<p>该查询同样是通过子查询扫描字段 id，效果同方式 4。但方式 5 的性能会略好于方式 4，因为它不需要进行表的关联，而是一个简单的比较，在不知道上一页最大 id 的情况下，是比较推荐的用法。</p>
<h2 id="插入表情"><a href="#插入表情" class="headerlink" title="插入表情"></a>插入表情</h2><ol>
<li>MySQL 的版本</li>
</ol>
<p>utf8mb4 的最低 mysql 版本支持版本为 5.5.3+，若不是，请升级到较新版本。</p>
<ol start="2">
<li>MySQL 驱动</li>
</ol>
<p>5.1.34 可用,最低不能低于 5.1.13</p>
<ol start="3">
<li>修改 MySQL 配置文件</li>
</ol>
<p>修改 mysql 配置文件 my.cnf</p>
<p>my.cnf 一般在 etc/mysql/my.cnf 位置。找到后请在以下三部分里添加如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">default-character-set = utf8mb4</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set = utf8mb4</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">character-set-client-handshake = FALSE</span><br><span class="line">character-set-server = utf8mb4</span><br><span class="line">collation-server = utf8mb4_unicode_ci</span><br><span class="line">init_connect=&#x27;SET NAMES utf8mb4&#x27;</span><br></pre></td></tr></table></figure>

<p>重启 mysql:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">一、MySQL启动方式</span><br><span class="line">1、使用 service 启动：service mysqld start</span><br><span class="line">2、使用 mysqld 脚本启动：/etc/init.d/mysqld start</span><br><span class="line">3、使用 safe_mysqld 启动：safe_mysqld&amp;</span><br><span class="line">二、MySQL停止</span><br><span class="line">1、使用 service 启动： service mysqld stop</span><br><span class="line">2、使用 mysqld 脚本启动：/etc/init.d/mysqld stop</span><br><span class="line">3、mysqladmin shutdown</span><br><span class="line">三、MySQL重启</span><br><span class="line">1、使用 service 启动：service mysqld restart</span><br><span class="line">2、使用 mysqld 脚本启动：/etc/init.d/mysqld restart</span><br><span class="line">四、强制关闭</span><br><span class="line">以上方法都无效的时候，可以通过强行命令：“killall mysql”来关闭MySQL，但是不建议用这样的方式，</span><br><span class="line">据库服务，有可能导致表损坏……所以自己掂量着用。</span><br><span class="line">Windows下重启MySQL服务,对于没装mysql图形管理端的用户来说启动和停止mysql服务：</span><br><span class="line">…\…\bin&gt;net stop mysql</span><br><span class="line">…\…\bin&gt;net start mysql</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当数据库中涉及编码类型改变的时候，需要统一数据库，表，字段的编码类型，少一个都不行。</p>
</blockquote>
<p> 修改数据库字符集：<br> <code>ALTER DATABASE database_name CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;</code><br> 修改表的字符集：<br> <code>ALTER TABLE table_name CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;</code><br> 修改字段的字符集：<br> <code>ALTER TABLE table_name CHANGE column_name column_name VARCHAR(191) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;</code></p>
<ol start="4">
<li>查看是否成功修改<br>使用<code>SHOW VARIABLES WHERE Variable_name LIKE &#39;character_set_%&#39; OR Variable_name LIKE &#39;collation%&#39;;</code>查看当前编码,结果中的 collation_connection 、collation_database 、collation_server 是什么没关系。但必须保证系统变量 描述</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">character_set_client (客户端来源数据使用的字符集)</span><br><span class="line">character_set_connection (连接层字符集)</span><br><span class="line">character_set_database (当前选中数据库的默认字符集)</span><br><span class="line">character_set_results (查询结果字符集)</span><br><span class="line">character_set_server (默认的内部操作字符集)</span><br></pre></td></tr></table></figure>

<p>这几个变量必须是 utf8mb4,才能插入表情。</p>
<p>查看表编码<br><code>mysql&gt; show create table dictionary; # dictionary 是表名</code></p>
<ol start="5">
<li>数据库连接的配置<br>数据库连接参数中也要设置为 utf8bm4 格式，否则是无法插入的<br><code>charset=utf8mb4</code></li>
</ol>
<h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><ul>
<li>多表查询语法<br><code>select  字段1,字段2... from 表1,表2... [where 条件]</code></li>
<li>多表链接查询<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">多表连接查询语法(重点)</span><br><span class="line">SELECT 字段列表</span><br><span class="line">    FROM 表1  INNER|LEFT|RIGHT JOIN  表2</span><br><span class="line">ON 表1.字段 = 表2.字段;</span><br></pre></td></tr></table></figure>
内连接查询与多表联合查询的效果是一样的,左外连接查询 (左边表中的数据优先全部显示),右外连接查询 (右边表中的数据优先全部显示)</li>
</ul>
<p>全连接查询(显示左右表中全部数据)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//全连接查询：是在内连接的基础上增加 左右两边没有显示的数据</span><br><span class="line">//注意: mysql并不支持全连接 full JOIN 关键字</span><br><span class="line">//注意: 但是mysql 提供了 UNION 关键字.使用 UNION 可以间接实现 full JOIN 功能</span><br><span class="line">select * from student left join sc on student.sid = sc.sid</span><br><span class="line">UNION</span><br><span class="line">select * from student right join sc on student.sid = sc.sid;</span><br><span class="line">/注意: UNION 和 UNION ALL 的区别:UNION 会去掉重复的数据,而 UNION ALL 则直接显示结果/</span><br></pre></td></tr></table></figure>
<ul>
<li>三表查询</li>
</ul>
<p><code>select 表1.字段,表2.字段,表3.字段 from 表1 join 表2 on 表1.关联字段 = 表2.关联字段 join 表3 on 表2.关联字段 = 表3.关联字段 where....;</code></p>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD<br>方式3：基于索引再排序<br>=======</p>
<h2 id="数据库备份与还原"><a href="#数据库备份与还原" class="headerlink" title="数据库备份与还原"></a>数据库备份与还原</h2><blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>3c5cfeb51abb6cea4e5e0de711a8fed595408289</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<ol>
<li><p>备份原文件<br>MySQL中的每一个数据库和数据表分别对应文件系统中的目录和其下的文件。在Linux下数据库文件的存放目录一般为/var/lib/mysql。在Windows下这个目录视MySQL的安装路径而定。备份文件前，需要将MySQL服务停止，然后将数据库目录拷贝即可。恢复数据数据库时，需要先创建好一个数据库(不一定同名)，然后将备份出来的文件(注意，不是目录)复制到对应的MySQL数据库目录中。使用这一方法备份和恢复数据库时，需要新旧的MySQL版本一致，否则可能会出现错误。</p>
</li>
<li><p>使用命令</p>
</li>
</ol>
<p>备份数据库：<br><code>mysqldump –user=root –password=root密码 –lock-all-tables 数据库名 &gt; 备份文件.sql</code></p>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD<br>该方式就部分解决了方式2的问题，但如果当前在第2页，要查第1000页，性能仍然较差。</p>
<p>方式4：</p>
<p>select * from table as a inner join (select id from table order by id limit m, n) as b on a.id = b.id order by a.id;</p>
<p>该查询同方式1一样，m的值可能很大，但由于内部的子查询只扫描了id字段，而非全表，所以性能要强于方式1，并且能够解决跨页查询问题。</p>
<p>方式5：</p>
<p>select * from table where id &gt; (select id from table order by id limit m, 1) limit n;</p>
<p>该查询同样是通过子查询扫描字段id，效果同方式4。但方式5的性能会略好于方式4，因为它不需要进行表的关联，而是一个简单的比较，在不知道上一页最大id的情况下，是比较推荐的用法。</p>
<p>方法6: 基于索引使用prepare<br>（第一个问号表示pageNum，第二个？表示每页元组数）</p>
<p>—语句样式: MySQL中,可用如下方法:</p>
<p>代码如下:</p>
<p>PREPARE stmt_name FROM SELECT * FROM 表名称 WHERE id_pk &gt; (？* ？) ORDER BY id_pk<br>ASC LIMIT M<br>—适应场景: 大数据量。</p>
<p>—原因: 索引扫描,速度会很快. prepare语句又比一般的查询语句快一点。</p>
<p>方法7:利用MySQL支持ORDER操作可以利用索引快速定位部分元组,避免全表扫描<br>—比如: 读第1000到1019行元组(pk是主键/唯一键)。</p>
<p>代码如下:</p>
<h1 id="—SELECT-FROM-your-table-WHERE-pk-gt-1000-ORDER-BY-pk-ASC-LIMIT-0-20"><a href="#—SELECT-FROM-your-table-WHERE-pk-gt-1000-ORDER-BY-pk-ASC-LIMIT-0-20" class="headerlink" title="—SELECT * FROM your_table WHERE pk&gt;=1000 ORDER BY pk ASC LIMIT 0,20"></a>—SELECT * FROM your_table WHERE pk&gt;=1000 ORDER BY pk ASC LIMIT 0,20</h1><p>恢复数据库：<br><code>mysql -u root –password=root密码 数据库名 &lt; 备份文件.sql</code></p>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>3c5cfeb51abb6cea4e5e0de711a8fed595408289</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.baidu.com/2021/11/12/22-23-33/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KK">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KK">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/11/12/22-23-33/" class="post-title-link" itemprop="url">echart</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-12 22:23:33" itemprop="dateCreated datePublished" datetime="2021-11-12T22:23:33+08:00">2021-11-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-06 11:30:12" itemprop="dateModified" datetime="2023-02-06T11:30:12+08:00">2023-02-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index"><span itemprop="name">web</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="echart"><a href="#echart" class="headerlink" title="echart"></a>echart</h1><ol>
<li>echarts的图表是画在canvas上的， 可以通过grid设置来调整图表与canvas的间距：grid:{ x:50, y:50,x2:50,  y2:60,}</li>
<li>通过回调函数判断是否是第一个数据（params.dataIndex 的值）来决定是否显示相应的内容：formatter:(n)=&gt;{return n.dataIndex}</li>
<li>echarts3.0已支持多标题的设置</li>
<li>Echarts设置tooltip层级z-index<br>tooltip有一个extraCssText属性。所以可以设置该属性来修改它的样式：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tooltip:&#123;extraCssText:&#x27;z-index:2&#x27;&#125;</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.baidu.com/2021/11/12/22-23-33/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KK">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KK">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/11/12/22-23-33/" class="post-title-link" itemprop="url">wifiDog</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-12 22:23:33" itemprop="dateCreated datePublished" datetime="2021-11-12T22:23:33+08:00">2021-11-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-06 11:30:12" itemprop="dateModified" datetime="2023-02-06T11:30:12+08:00">2023-02-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index"><span itemprop="name">web</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="wifiDog"><a href="#wifiDog" class="headerlink" title="wifiDog"></a>wifiDog</h1><p>首先简介一下什么是Portal认证。Portal认证。通常也会叫Web认证。未认证用户上网时，设备强制用户登录到特定站点，用户能够免费訪问当中的服务。当用户须要使用互联网中的其他信息时，必须在门户站点进行认证。仅仅有认证通过后才干够使用互联网资源。</p>
<p>现金非常多中国移动CMCC、中国联通、中国电信ChinaNet的WIFI都使用这样的认证接入方式。</p>
<p>在OpenWRT上实现Portal认证，实际上早已有解决方式：</p>
<ol>
<li>chillispot，但原维护作者停止更新。被chillispot.info接管继续开发；</li>
</ol>
<p>2.coova-chilli，它是基于chillispot开发拓展的，功能最为强大；能够去官方看一下Coova-chilli；</p>
<p>3.wifidog</p>
<p>前两个因为原维护作者停止更新。笔者也没有深入研究，重点钻研了wifidog，Wifidog也是OpenWRT和DD-WRT中实现Portal比較出名的。</p>
<p>可是。Wifidog仅仅是实现AP认证网关，须要配合外部的Portalserver才干使用。Portal主要是提供认证所需的WEB页面且实现认证计费等的功能。尽管这也有非常多商用解决方式，比如wiwiz、wifiap等，可是这些商业解决方式的目标都是盈利。即使能够免费使用。免费账号的功能和权限都受到了非常大的限制，比如不能自己定义页面。Web认证页面有广告等等。有条件的人可能打算自己搭建Portalserver。可是看看Wifidog的官方Wiki。对搭建过程实在是难以理解。后来，笔者发现网络上另一个authpuppy方案，官方站点<a target="_blank" rel="noopener" href="http://www.authpuppy.org.是一个已实现好的wifidog认证server,里面包括各种插件供你使用,官方的安装过程也非常easy,假设你懂的html和面向对象编程的相关知识且拥有一个server,能够自行改动认证页面.使用authpuppy也是一个不错的方案./">www.authpuppy.org。是一个已实现好的Wifidog认证server，里面包括各种插件供你使用，官方的安装过程也非常easy，假设你懂的HTML和面向对象编程的相关知识且拥有一个server，能够自行改动认证页面。使用authpuppy也是一个不错的方案。</a></p>
<p>可是。即便如此，这些方案还是不够灵活，经过笔者认真钻研。查阅大量资料并经过多次抓包分析，最终理解了Wifidog的工作原理。</p>
<p>接下来笔者将会跟你介绍怎样自行编写一个轻量级的Web Portal认证server。当然。这须要你具有程序设计基础，HTML、CSS当然是少不得的。后端开发语言能够使用PHP或Python或Java等。</p>
<p>首先，须要简介一下Wifidog的工作原理：</p>
<p>1.client发出初始化请求，比方訪问 <a target="_blank" rel="noopener" href="http://www.baidu.com./">www.baidu.com。</a></p>
<p>2.网关的防火墙规则将这个请求重定向到本地网关的port上。这个port是Wifidog监听的port。</p>
<p>3.Wfidog提供一个HTTP重定向回复，重定向到Web认证页面。重定向的Url的Querystring中包括了Gateway的ID，Gateway的FQDN以及其它的信息。</p>
<p>4.用户向认证server发出认证请求</p>
<p><a href="http://portal_server:port/login_script">http://portal_server:port/login_script</a>?</p>
<p>gw_id=[GatewayID, default: “default”]</p>
<p>gw_address=[GatewayAddress, internal IP of router]</p>
<p>gw_port=[GatewayPort, port that wifidog Gateway is listening on]</p>
<p>url=[user requested url]；</p>
<p>5.网关返回一个（能够是自己定义的）splash（也称作“登录”）页面。</p>
<p>6.用户提供他的凭据信息，比方username和password。</p>
<p>7.成功认证的话，client将会被重定向到网关的自己的web页面上，而且带有一个认证凭据（一个一次性的token），内容比方：</p>
<p><a href="http://GatewayIP:GatewayPort/wifidog/auth?token=[auth">http://GatewayIP:GatewayPort/wifidog/auth?token=[auth</a> token]；</p>
<p>8.用户就是用获取到的凭据訪问网关。</p>
<p>9.网关去认证server询问token的有效性。</p>
<p>10.认证server确认token的有效性。</p>
<p>11.网关发送重定向给client。以从认证服务器上获取 成功提示页面，重定向到 <a href="http://portal_server:port/portal_script">http://portal_server:port/portal_script</a> 这个位置。</p>
<p>12.认证server通知客户请求成功，能够上网了。</p>
<p>图解:</p>
<p>图解Wifidog工作原理</p>
<p>然后考察一下Wifidog的配置文件/etc/wifidog.conf，关键的配置项是：</p>
<p>AuthServer {</p>
<p>Hostname             (Mandatory; Default: NONE)</p>
<p>SSLAvailable           (Optional; Default: no; Possible values: yes, no)</p>
<p>SSLPort               (Optional; Default: 443)</p>
<p>HTTPPort             (Optional; Default: 80)</p>
<p>Path                  (Optional; Default: /wifidog/ Note:  The path must be both prefixed and suffixed by /.  Use a single / for server root.)</p>
<p>LoginScriptPathFragment  (Optional; Default: login/?</p>
<p>Note:  This is the script the user will be sent to for login.)</p>
<p>PortalScriptPathFragment (Optional; Default: portal/? Note:  This is the script the user will be sent to after a successfull login.)</p>
<p>MsgScriptPathFragment    (Optional; Default: gw_message.php? Note:  This is the script the user will be sent to upon error to read a readable message.)</p>
<p>PingScriptPathFragment    (Optional; Default: ping/?</p>
<p>Note:  This is the script the user will be sent to upon error to read a readable message.)</p>
<p>AuthScriptPathFragment    (Optional; Default: auth/?</p>
<p>Note:  This is the script the user will be sent to upon error to read a readable message.)</p>
<p>}</p>
<h1 id="Listen-on-this-port"><a href="#Listen-on-this-port" class="headerlink" title="Listen on this port"></a>Listen on this port</h1><p>GatewayPort 2060</p>
<h1 id="Parameter-CheckInterval"><a href="#Parameter-CheckInterval" class="headerlink" title="Parameter: CheckInterval"></a>Parameter: CheckInterval</h1><h1 id="Default-60"><a href="#Default-60" class="headerlink" title="Default: 60"></a>Default: 60</h1><h1 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional</h1><h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="How-many-seconds-should-we-wait-between-timeout-checks-This-is-also"><a href="#How-many-seconds-should-we-wait-between-timeout-checks-This-is-also" class="headerlink" title="How many seconds should we wait between timeout checks.  This is also"></a>How many seconds should we wait between timeout checks.  This is also</h1><h1 id="how-often-the-gateway-will-ping-the-auth-server-and-how-often-it-will"><a href="#how-often-the-gateway-will-ping-the-auth-server-and-how-often-it-will" class="headerlink" title="how often the gateway will ping the auth server and how often it will"></a>how often the gateway will ping the auth server and how often it will</h1><h1 id="update-the-traffic-counters-on-the-auth-server-Setting-this-too-low"><a href="#update-the-traffic-counters-on-the-auth-server-Setting-this-too-low" class="headerlink" title="update the traffic counters on the auth server.  Setting this too low"></a>update the traffic counters on the auth server.  Setting this too low</h1><h1 id="wastes-bandwidth-setting-this-too-high-will-cause-the-gateway-to-take"><a href="#wastes-bandwidth-setting-this-too-high-will-cause-the-gateway-to-take" class="headerlink" title="wastes bandwidth, setting this too high will cause the gateway to take"></a>wastes bandwidth, setting this too high will cause the gateway to take</h1><h1 id="a-long-time-to-switch-to-it’s-backup-auth-server-s"><a href="#a-long-time-to-switch-to-it’s-backup-auth-server-s" class="headerlink" title="a long time to switch to it’s backup auth server(s)."></a>a long time to switch to it’s backup auth server(s).</h1><p>CheckInterval 60</p>
<h1 id="Parameter-ClientTimeout"><a href="#Parameter-ClientTimeout" class="headerlink" title="Parameter: ClientTimeout"></a>Parameter: ClientTimeout</h1><h1 id="Default-5"><a href="#Default-5" class="headerlink" title="Default: 5"></a>Default: 5</h1><h1 id="Optional-1"><a href="#Optional-1" class="headerlink" title="Optional"></a>Optional</h1><h1 id="-1"><a href="#-1" class="headerlink" title=""></a></h1><h1 id="Set-this-to-the-desired-of-number-of-CheckInterval-of-inactivity-before-a-client-is-logged-out"><a href="#Set-this-to-the-desired-of-number-of-CheckInterval-of-inactivity-before-a-client-is-logged-out" class="headerlink" title="Set this to the desired of number of CheckInterval of inactivity before a client is logged out"></a>Set this to the desired of number of CheckInterval of inactivity before a client is logged out</h1><h1 id="The-timeout-will-be-INTERVAL-TIMEOUT"><a href="#The-timeout-will-be-INTERVAL-TIMEOUT" class="headerlink" title="The timeout will be INTERVAL * TIMEOUT"></a>The timeout will be INTERVAL * TIMEOUT</h1><p>ClientTimeout 5</p>
<p>AuthServer是Portalserver的配置项。GatewayPort是Wifidog监听的地址。默认是2060。一般保持默认就可以；CheckInterval是心跳时长。单位是秒。什么是心跳呢，client认证成功之后，假设有网络訪问动作，Wifidog getway就会每隔一段时间訪问Portalserver的一个脚本。用于认证计费。当然。假设客户使用超时或超流量，也能够通过心跳强制client下线。ClientTimeout是用户一次认证成功后的网络訪问时长，超过这个时间须要又一次认证，这个时长并不是由ClientTimeout单独决定。取决于INTERVAL * TIMEOUT。</p>
<p>具体的配置信息能够訪问：<a target="_blank" rel="noopener" href="http://dev.wifidog.org/browser/trunk/wifidog/wifidog.conf%E3%80%82">http://dev.wifidog.org/browser/trunk/wifidog/wifidog.conf。</a></p>
<p>我们重点讨论Portalserver的配置项，Hostname是Portalserver的ip或者是域名。SSLAvailable和SSLPort是SSL加密配置，假设你的Portalserver有配置HTTPS加密，则须要配置这两项。Path是指你的脚本路径(举例。<a target="_blank" rel="noopener" href="http://a.com/to/%EF%BC%8C%E5%88%99a.com%E6%98%AF%E5%9F%9F%E5%90%8D%E3%80%82/to/%E6%98%AF%E8%B7%AF%E5%BE%84)%EF%BC%8C%E6%B3%A8%E6%84%8F%E8%B7%AF%E5%BE%84%E5%BF%85%E9%A1%BB%E4%BB%A5%E2%80%9C/%E2%80%9D%E5%BC%80%E5%A4%B4%E5%92%8C%E7%BB%93%E5%B0%BE%EF%BC%8C%E5%81%87%E8%AE%BE%E6%98%AF%E6%A0%B9%E8%B7%AF%E5%BE%84%E3%80%82%E5%88%99%E5%A1%AB%E4%B8%80%E4%B8%AA%E2%80%9C/%E2%80%9D%E5%B0%B1%E5%8F%AF%E4%BB%A5%EF%BC%9B%E6%8E%A5%E4%B8%8B%E6%9D%A5%E7%9A%845%E4%B8%AA%E9%85%8D%E7%BD%AE%E6%8C%87%E6%98%8E%E4%BD%A0%E7%9A%84%E8%84%9A%E6%9C%AC%E5%90%8D%EF%BC%8C%E8%BF%99%E8%AF%B4%E6%98%8E%E4%BA%86%E6%88%91%E4%BB%AC%E9%A1%BB%E8%A6%81%E5%86%99%E4%BA%94%E4%B8%AA%E8%84%9A%E6%9C%AC%EF%BC%8C%E6%88%91%E4%BC%9A%E5%85%B7%E4%BD%93%E8%AF%B4%E6%98%8E%E3%80%82">http://a.com/to/，则a.com是域名。/to/是路径)，注意路径必须以“/”开头和结尾，假设是根路径。则填一个“/”就可以；接下来的5个配置指明你的脚本名，这说明了我们须要写五个脚本，我会具体说明。</a></p>
<p>(下面文中涉及的“第几步”均是指Wifidog认证过程的步骤)</p>
<p>LoginScriptPathFragment配置项配置的是登陆脚本，它通过GET方式接受传入參数gw_address、gw_port、gw_id、mac和url。gw_address是AP Getway的ip地址；gw_port是Wifidog监听的端口。即上面介绍的wifidog.conf中的GatewayPort配置；gw_id是AP Getway的id。配置文件wifidog.conf中能够配置，默认值是default，这个值的作用是当存在多个AP是，server或管理员能够依据不同的id确定用户的接入点；mac是客户计算机的网卡物理地址。注意不是AP网关的mac。这个mac是用来识别客户计算机的；url是客户初始訪问的Url。这些Querystring都是AP Getway向client发出重定向请求自己主动生成的。</p>
<p>这个脚本同一时候须要提供登陆页面，假设登陆成功，须要向客户。端返回302重定向，重定向到：<a href="http://gw_address:gw_port/wifidog/auth">http://gw_address:gw_port/wifidog/auth</a>?</p>
<p>token=[token]；即实现第7步。当中[token]是你自己自己主动生成的token字符串，随机生成一个字符串就可以，可是长度最好长些，安全性更高，另外，token须要依据不同用户保存，最好保存于数据库中，之后的AP Getway询问token有效性(第9步)还须要用到。这里最好使用cookie或session，使之后的登陆成功页面能够推断用户已经成功，阻止未登录成功的人訪问认证成功页面。</p>
<p>PortalScriptPathFragment配置项配置的是登陆成功后server展示的脚本(第11步)，它通过GET方式接受1个传入參数，gw_id。这个脚本比較简单。告知用户登陆成功就可以，当然，最好重定向到用户之前想要方位的url。即第1步用户输入的URL。</p>
<p>MsgScriptPathFragment配置项配置的是错误信息展示脚本，它通过GET方式接受一个传入參数message，这个脚本也非常easy，展示message的内容就可以。目的是当认证过程出现错误，AP Getway会重定向到这个脚本，URL中含有错误的信息。</p>
<p>PingScriptPathFragment配置项配置的是心跳脚本。这个脚本它通过GET方式接受5个传入參数，gw_id，sys.uptime，sys.memfree，sys.load，wifidog.uptime，当中，sys.uptime指的是AP Getway的启动时间。sys.memfree指的是AP Getway的空暇内存，sys.load指的是AP Getway的CPU负载。wifidog.uptime指的是wifidog的启动时间，这个脚本每隔一段时间(Wifidog.conf里配置的CheckInterval)，Wifidog会自己主动訪问，可是其目的不是用户验证，而是帮助管理员管理AP节点，了解AP节点的负载情况，适时添加节点等，Wifidog訪问这个脚本时，须要这个脚本返回Pong。假设你没有统计AP节点负载数据的需求，能够丢弃这些数据。直接回应Pong，注意，这个回应仅仅包括“Pong”字符串。无需包括其它html标签。</p>
<p>AuthScriptPathFragment是用户认证脚本。实现的是第10步的功能。这个脚本它通过GET方式接受7个传入參数：stage、ip、mac、token、incoming、outcoming和gw_id。当中stage的值是login，ip是client的ip，注意不是AP Getwap的ip；mac是client的网卡物理地址。token就是你在认证脚本生成并返回给client的。incoming和outcoming用于流量控制，默认值为0；gw_id同上。</p>
<p>怎样识别用户登录成功，通过mac和token吧，LoginScriptPathFragment登陆脚本在用户登陆成功后须要记录用户的mac和token。然后在此处验证，假设匹配。回复Auth: 1，否则。回复Auth: 0。</p>
<p>另外，这个脚本也是心跳脚本。每隔一段时间Wifidog会自己主动訪问，假设用户使用时间超过限制或流量超过额度。server能够及时回应Auth: 0结束用户的訪问。</p>
<p>另外须要注意的是。回应相同无需包括html标签，另外，在Auth后的冒号和0/1之间，有一个空格，缺少这个空格也会导致出错。</p>
<p>在配置Wifidog的配置文件wifidog.conf是。配置脚本的配置项都必须以“?</p>
<p>”结尾，否则以GET方式传递的QueryString会因Url缺少问号訪问错误的脚本。</p>
<p>看到了吧。只5个简单脚本。就能够实现利用Wifidog的Portal认证，当然。这过中还能够有非常多应用尚未发掘，比方流量控制、带宽控制、结合Radiusserver实现认证等。你的开发也能够更上一层楼。实现很多其它功能。只是笔者另一个建议。在登录页面除了username和password意外，最好加个验证码，防止不怀好意之人暴力破解。</p>
<p>这样，你仅仅须要一个免费的空间，甚至是简单的百度云、新浪SAE等。就能够实现一个认证server。有的人可能还会问，能不能把这些脚本集成到路由器其中，我的回答是能，仅仅要你的脚本的功能不多。问题应该不大，可是这么做的风险比較大，路由的负载比較高，导致路由的执行会非常不稳定，甚至常常死机，这也是笔者亲身实践的结果，所以笔者不建议这么做。</p>
<p>最后啰嗦提醒的是，WiFidog是使用iptables基于三层协议工作的，所以使用Wifidog的结果是。不仅是Wifi接入须要Portal认证，有线接入相同须要认证。</p>
<p>避免这样的情况最简单的做法是设立mac白名单。可能有的人又会问。能不能做到仅是Wifi接入须要认证，有线接入的无需认证。有的人可能想更上一层楼，能不能开两个Wifi，仅当中一个Wifi须要认证，还有一个Wifi和有线网络不须要Portal认证，我的回答是能。至于详细做法，以后再介绍。</p>
<hr>
<ol>
<li><p>在这个配置文件里面第一格不能是空格，否则就会出错。</p>
</li>
<li><p>GatewayAddress  192.168.1.1 //路由器地址</p>
</li>
<li><p>GatewayID 123456789 //与服务器authpuppy中对应</p>
</li>
<li><p>ExternalInterface eth0.2  //外网接口，这个是wan口，连接到Internet的接口</p>
</li>
<li><p>GatewayInterface  br-lan  //内网接口，这个是lan口，连接到局域网的接口</p>
</li>
<li><p>AuthServer {                        //认证服务器配置项                             </p>
</li>
</ol>
<p>Hostname xx.xx.xx.xx //认证服务器IP地址或者名                                                 </p>
<p>SSLAvailable no //认证服务器有HTTPS加密则配置该项，此处无</p>
<p>SSLPort //认证服务器有HTTPS加密则配置该项，此处无</p>
<p>Path /authpuppy/web/        (认证路径)</p>
<p>/<strong><strong><strong><strong><strong><strong><strong><strong>此处为wifidog认证服务器的五个脚本文件，用于认证</strong></strong></strong></strong></strong></strong></strong></strong>****/</p>
<p>LoginScriptPathFragment //登录展示的脚本，以get的方式传入gw_address、gw_port、gw_id、mac、url(AP的IP地址，wifidog监听端口，AP的ID，客户端mac地址，客户初始访问的url)</p>
<p>PortalScriptPathFragment //客户端登陆成功后展示的脚本，之传入gw_id一个参数，用于告知用户登陆成功</p>
<p>MsgScriptPathFragment //错误信息展示脚本，通过get方式传入一个参数message，用于展示认证中出现错误的页面</p>
<p>PingScriptPathFragment //心跳脚本，通过get方式传入5个参数，gw_id，sys.uptime，sys.memfree，sys.load，wifidog.uptime；wifidog每隔一段时间访问一次这个脚本(时间间隔由CheckInterval决定)。注意，此脚本需要返回“Pong”字符串</p>
<p>AuthScriptPathFragment //用户认证脚本，通过get的方式接受7各参数，stage,ip,mac,token,incoming,outcoming和gw_id；stage的值为login,ip为客户端IP，mac为客户端的mac地址，                  }还有这个Path，一开始我是设置成  /   根目录，结果不行，出现了这个问题：HTTP Response from Server: [HTTP/1.1 404 Not Found后来设置成这个目录才可以。还有一点要注意的是Path的目录两边都要加/，不然也会出错。</p>
<ol start="7">
<li><p>GatewayPort 2060 //wifidog的监听地址，通常保持默认</p>
</li>
<li><p>CheckInterval 60 //心跳时长，单位是秒，</p>
</li>
</ol>
<p>心跳：客户端认证成功，如果有网络访问动作，Wifidog getway就会每隔一段时间访问Portal服务器的一个脚本，用于认证计费，当然，如果客户使用超时或超流量，也可以通过心跳强制客户端下线</p>
<ol start="9">
<li>ClientTimeout 5 //ClientTimeout是用户一次认证成功后的网络访问时长，超过这个时间需要重新认证</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.baidu.com/2021/11/12/20-23-33/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KK">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KK">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/11/12/20-23-33/" class="post-title-link" itemprop="url">element UI</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-12 20:23:33" itemprop="dateCreated datePublished" datetime="2021-11-12T20:23:33+08:00">2021-11-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-06 11:33:46" itemprop="dateModified" datetime="2023-02-06T11:33:46+08:00">2023-02-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index"><span itemprop="name">web</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="element-UI"><a href="#element-UI" class="headerlink" title="element UI"></a>element UI</h1><h2 id="element的表单校验输入框有值但校验未通过："><a href="#element的表单校验输入框有值但校验未通过：" class="headerlink" title="element的表单校验输入框有值但校验未通过："></a>element的表单校验输入框有值但校验未通过：</h2><ul>
<li><p><code>:model=&quot;ruleForm&quot;</code> 绑定的<code>ruleForm</code>值是否挂载成功并且操作的是否是这个表单。</p>
</li>
<li><p><code>:rules=&quot;rules&quot;</code> 校验的规则格式绑定的<code>rules</code>是否定义并且格式正确为对象数组。</p>
</li>
<li><p><code>el-form-item中的</code>prop=”name”<code>是否和rules中的</code>name: [ { required: true, message: ‘请输入活动名称’, trigger: ‘blur’ }, ], <code>的名称一致，两个</code>name`相同的，element的校验就是根据这个prop找对应的输入框的。</p>
</li>
<li><p><code>&lt;el-input v-model=&quot;ruleForm.name&quot;&gt;&lt;/el-input&gt;</code> 的<code>v-model=&quot;ruleForm.name&quot;</code>确保对象<code>ruleForm</code>中有<code>name</code>这个属性！</p>
</li>
</ul>
<h2 id="el-table格式化el-table-column内容："><a href="#el-table格式化el-table-column内容：" class="headerlink" title="el-table格式化el-table-column内容："></a>el-table格式化el-table-column内容：</h2><ul>
<li>v-if判断<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">        &lt;span v-if=&quot;scope.row.xxxx == 0&quot;&gt;&lt;/span&gt;</span><br><span class="line">    &lt;/template&gt;</span><br></pre></td></tr></table></figure></li>
<li>使用formatter属性<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table-column prop=&quot;xxx&quot;   :formatter=&quot;function(row, column)&#123;xxxx&#125;&quot;&gt;</span><br></pre></td></tr></table></figure>
<h2 id="ElementUI的el-table-默认内容不换行，让el-table-column根据占位符-n换行："><a href="#ElementUI的el-table-默认内容不换行，让el-table-column根据占位符-n换行：" class="headerlink" title="ElementUI的el-table 默认内容不换行，让el-table-column根据占位符\n换行："></a>ElementUI的el-table 默认内容不换行，让el-table-column根据占位符\n换行：</h2></li>
</ul>
<p>添加css样式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.el-table &gt;&gt;&gt;.cell &#123;</span><br><span class="line">    white-space: pre-line;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="点击时获取列表的值，可通过给节点添加data自定义属性，通过点击事件e-currentTarget-dataset获取属性值"><a href="#点击时获取列表的值，可通过给节点添加data自定义属性，通过点击事件e-currentTarget-dataset获取属性值" class="headerlink" title="点击时获取列表的值，可通过给节点添加data自定义属性，通过点击事件e.currentTarget.dataset获取属性值"></a>点击时获取列表的值，可通过给节点添加data自定义属性，通过点击事件e.currentTarget.dataset获取属性值</h2><h2 id="element获取table表格行数据，可通过template设置slot-scope-“scope”属性，在传参时使用scope-row-xxxx拿到当前行的数据"><a href="#element获取table表格行数据，可通过template设置slot-scope-“scope”属性，在传参时使用scope-row-xxxx拿到当前行的数据" class="headerlink" title="element获取table表格行数据，可通过template设置slot-scope=“scope”属性，在传参时使用scope.row.xxxx拿到当前行的数据"></a>element获取table表格行数据，可通过template设置slot-scope=“scope”属性，在传参时使用scope.row.xxxx拿到当前行的数据</h2><h2 id="当只有⼀个el-input的时候，可以⽤elementUI的⾃带的回车键触发提交事件但是有时候会同时触发刷新页⾯，这样可以在el-form上添加-submit-native-prevent来解决"><a href="#当只有⼀个el-input的时候，可以⽤elementUI的⾃带的回车键触发提交事件但是有时候会同时触发刷新页⾯，这样可以在el-form上添加-submit-native-prevent来解决" class="headerlink" title="当只有⼀个el-input的时候，可以⽤elementUI的⾃带的回车键触发提交事件但是有时候会同时触发刷新页⾯，这样可以在el-form上添加@submit.native.prevent来解决"></a>当只有⼀个el-input的时候，可以⽤elementUI的⾃带的回车键触发提交事件但是有时候会同时触发刷新页⾯，这样可以在el-form上添加@submit.native.prevent来解决</h2><h2 id="element-el-input的autofocus失效问题解决"><a href="#element-el-input的autofocus失效问题解决" class="headerlink" title="element el-input的autofocus失效问题解决"></a>element el-input的autofocus失效问题解决</h2><blockquote>
<p>autofocus是input的原生属性,饿了么组件也支持这种方法, 但是input外面还有其他组件, 导致autofocus失效, 只能手动调用focus方法:组件上绑定ref，手动调用focus()</p>
</blockquote>
<h2 id="elementUI选择器select获取选中对象"><a href="#elementUI选择器select获取选中对象" class="headerlink" title="elementUI选择器select获取选中对象"></a>elementUI选择器select获取选中对象</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">有些情况下需要获取选中对象的全部数据，添加 value-key=&quot;id&quot; ，value-key 为唯一性标识, 将 value 绑定为item</span><br><span class="line">&lt;el-select v-model=&quot;area&quot; value-key=&quot;id&quot; placeholder=&quot;请选择区域&quot;&gt;</span><br><span class="line">    &lt;el-option v-for=&quot;item in areaLsit&quot; :key=&quot;item.id&quot; :label=&quot;item.areaName&quot; :value=&quot;item&quot;&gt;</span><br><span class="line">    &lt;/el-option&gt;</span><br><span class="line">&lt;/el-select&gt;</span><br></pre></td></tr></table></figure>

<h2 id="vue-css-gt-gt-gt-deep-穿透，深度查询样式在chrome89-edge新版本中无效问题"><a href="#vue-css-gt-gt-gt-deep-穿透，深度查询样式在chrome89-edge新版本中无效问题" class="headerlink" title="vue css &gt;&gt;&gt; /deep/穿透，深度查询样式在chrome89 edge新版本中无效问题"></a>vue css &gt;&gt;&gt; /deep/穿透，深度查询样式在chrome89 edge新版本中无效问题</h2><p>大概理解应该是<code>/deep/</code>基本上无效了，直接替换成“”空格，或者<code>&gt;&gt;&gt;</code>代替处理；</p>
<p>于是，在项目中全局替换<code>/deep/</code>为空格，但是部分页面会有错乱问题，于是将替换为空格后，仍然无效的样式部分，添加<code>&gt;&gt;&gt;</code>,居然可以了，但是对于Sass Less之类的预处理器是无法正确解析 <code>&gt;&gt;&gt;</code>的，所以要保证样式是css文件；</p>
<p>还有一点要强调，<code>&gt;&gt;&gt;</code>在html单页面下貌似无效，在vue项目中有效；</p>
<p>项目问题基本解决后，做一下汇总的情况下，上网查看关于样式穿透，发现除了<code>&gt;&gt;&gt;</code>、<code>/deep/</code>外，还有一个<code>::v-deep</code>，写法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">/用法1/</span><br><span class="line">.a&#123;</span><br><span class="line">::v-deep .b &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line">/用法2/</span><br><span class="line">.a ::v-deep .b &#123;&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.baidu.com/2021/11/12/20-21-33/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KK">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KK">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/11/12/20-21-33/" class="post-title-link" itemprop="url">subline text 编辑器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-12 20:21:33" itemprop="dateCreated datePublished" datetime="2021-11-12T20:21:33+08:00">2021-11-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-11-28 20:22:29" itemprop="dateModified" datetime="2021-11-28T20:22:29+08:00">2021-11-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tool/" itemprop="url" rel="index"><span itemprop="name">tool</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="subline-text-编辑器使用"><a href="#subline-text-编辑器使用" class="headerlink" title="subline text 编辑器使用"></a>subline text 编辑器使用</h1><h2 id="安装package-control"><a href="#安装package-control" class="headerlink" title="安装package control"></a>安装package control</h2><ol>
<li>首先打开编辑器，然后找到顶部菜单的<code>Tools</code>菜单</li>
<li>然后选择<code>Tools</code>菜单下面的<code>Command Paletter</code>选项</li>
<li>在打开的命令行模式输入框中输入<code>pac</code>,然后回车安装</li>
<li>稍等片刻以后,软件会提示信息,安装完了重新启动软件</li>
<li>重启以后,在菜单栏的<code>preferences</code>菜单下你会看到<code>Package Settings</code>和<code>Package Control</code>两个选项，以后会用到他们</li>
</ol>
<h2 id="设置为中文"><a href="#设置为中文" class="headerlink" title="设置为中文"></a>设置为中文</h2><ol>
<li>点击Package Control选项</li>
<li>选择installPackage</li>
<li>搜索ChineseLocalizations</li>
<li>点击安装</li>
</ol>
<h2 id="代码高亮"><a href="#代码高亮" class="headerlink" title="代码高亮"></a>代码高亮</h2><ol>
<li>将鼠标移至右下角的按钮区、点击</li>
<li>在弹出的菜单中找到当前文件类型</li>
<li>如果你想每次打开页面都出现语法高亮，可以将鼠标移至顶部“open all with current extension as…”，在弹出选项中选择“html”（按照你常用的文件类型设置），即可再下次打开文件后就出现高亮显示</li>
</ol>
<h2 id="设置自动保存"><a href="#设置自动保存" class="headerlink" title="设置自动保存"></a>设置自动保存</h2><ol>
<li>点击<code>Preferences</code>里的设置-用户</li>
<li><code>ctrl+f</code>找到<code>save_on_focus_lost</code>，把后面的<code>false</code>改成<code>true</code>就好</li>
</ol>
<h2 id="设置vim模式"><a href="#设置vim模式" class="headerlink" title="设置vim模式"></a>设置vim模式</h2><ol>
<li>点击<code>Preferences</code>里的设置-用户</li>
<li>编辑<code>Preferences.sublime-settings--User</code>文件</li>
<li>设置中的ignored_packages对应的列表中去掉Vintage这一项,没有ignored_packages这项就添加</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;ignored_packages&quot;:</span><br><span class="line">[</span><br><span class="line">//&quot;Vintage&quot;</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<h2 id="分屏"><a href="#分屏" class="headerlink" title="分屏"></a>分屏</h2><ol>
<li><p><code>Shift+Alt</code>+<code>1,2,3,4,5</code></p>
</li>
<li><p>文件克隆,拖放到另一个窗口上</p>
</li>
</ol>
<p>##关闭更新</p>
<p><code>Preferencens</code>设置用户, 添加<code>&quot;update_check&quot;: false</code></p>
<h2 id="关闭缩略图"><a href="#关闭缩略图" class="headerlink" title="关闭缩略图"></a>关闭缩略图</h2><p>关闭这个缩略图,需要到菜单视图里面设置，首先点击菜单栏<code>view</code>——<code>hideMiniMap</code></p>
<h2 id="格式化"><a href="#格式化" class="headerlink" title="格式化"></a>格式化</h2><p>按键绑定-用户-&gt;打开后在最后面添加</p>
<p><code>&#123; &quot;keys&quot;: [&quot;ctrl+shift+q&quot;], &quot;command&quot;: &quot;reindent&quot;&#125;,</code></p>
<h2 id="sublime-中用正则-去除空行、html注释和js注释"><a href="#sublime-中用正则-去除空行、html注释和js注释" class="headerlink" title="sublime 中用正则 去除空行、html注释和js注释"></a>sublime 中用正则 去除空行、html注释和js注释</h2><ol>
<li>去除空行</li>
</ol>
<p><code>CTRL+H</code>打开<code>replace</code>功能，勾选上左侧的<code>regular expression</code>，并填写 </p>
<p><code>find what</code>栏 : <code>\s+$</code>  （正则表达式）<br><code>replace with</code>栏 : （这行留空） </p>
<p>接着点<code>replace all</code>即可</p>
<ol start="2">
<li>去除html注释</li>
</ol>
<p><code>CTRL+H</code>打开<code>replace</code>功能，勾选上左侧的<code>regular expression</code>，并填写 </p>
<p><code>find what</code>栏 :<code> &lt;!--[\s\S]*?--&gt;</code>  （正则表达式）<br><code>replace with</code>栏 : （这行留空） </p>
<p>接着点<code>replace all</code>即可</p>
<ol start="3">
<li>去除js注释</li>
</ol>
<p><code>CTRL+H</code>打开<code>replace</code>功能，勾选上左侧的<code>regular expression</code>，并填写 </p>
<p><code>find what</code>栏 : <code>/\*[\s\S]*?/ </code> （正则表达式）<br><code>replace with</code>栏 : （这行留空） </p>
<p>接着点<code>replace all</code>即可</p>
<h2 id="解决文件名方格乱码"><a href="#解决文件名方格乱码" class="headerlink" title="解决文件名方格乱码"></a>解决文件名方格乱码</h2><p>可以在Sublime的user-settings中，覆盖默认的dpi，让Sublime以一个较小的文字显示</p>
<ol>
<li><p>点击Preferences –&gt; Settings–User</p>
</li>
<li><p>在最后一行加上”dpi_scale”: 1.0 （注意：在加上最后一段的时候，前面的字段要加上逗号“，”这是Sublime自己的命名规范）</p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.baidu.com/2021/08/22/20-22-11/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KK">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KK">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/22/20-22-11/" class="post-title-link" itemprop="url">VScode</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-22 20:22:11" itemprop="dateCreated datePublished" datetime="2021-08-22T20:22:11+08:00">2021-08-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-26 16:50:27" itemprop="dateModified" datetime="2023-02-26T16:50:27+08:00">2023-02-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tool/" itemprop="url" rel="index"><span itemprop="name">tool</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="vscode"><a href="#vscode" class="headerlink" title="vscode"></a>vscode</h1><h2 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h2><ul>
<li><p>VScode 关闭右侧预览功能：在设置中搜索”editor.minimap.enabled”把勾去掉</p>
</li>
<li><p>修改 vscode 配置文件改字体大小：打开 VSCode 安装目录下的如下文件 VSCode\resources\app\out\vs\workbench\workbench.desktop.main.css 查找 .part&gt;.content 修改字体大小即可</p>
</li>
<li><p>自动保存：</p>
</li>
</ul>
<p>打开 vscode 窗口，单击左下角的设置(齿轮状)图标<br>在设定按钮显示的菜单中，选择【Settings】选项。 这里是整个 vs 代码的设置入口<br>打开【settings】画面时，默认的【Auto Save】=【off】表示不自动保存，每次都需要用户自己手动保存<br>【后延迟】<br>1 )这是以一定的间隔自动保存的<br>2 )该【自动保存】选项需要指定间隔时间，以匹配下一个【自动保存延迟】配置项目，单位为毫秒<br>【onFocusChange】<br>1 )当焦点偏离编辑器当前窗口时自动保存<br>2 )即，即使在编辑器内部切换标签，也会触发自动保存<br>3 )本项目不需要【自动保存延迟】的设定值，此值也会被忽略<br>【onWindowChange】<br>1 )编辑器窗口失去焦点时，自动保存<br>2 )只有在焦点偏离整个编辑器时才会触发保存，在编辑器内部切换标签时不会自动保存<br>3 )本项目不需要【自动保存延迟】的设定值，此值也会被忽略<br>在【Settings】画面中修正值后，不点击追加保存按钮，自动保存设定的内容。</p>
<h2 id="vscode-好用的插件系列"><a href="#vscode-好用的插件系列" class="headerlink" title="vscode 好用的插件系列"></a>vscode 好用的插件系列</h2><ul>
<li>汉化插件： <code>Chinese (Simplified)</code></li>
<li>VIM:<code>Vim</code></li>
<li>git 相关插件：<code>gitLens</code>、<code>Git History</code>、<code>Git History Diff</code></li>
<li>格式化类插件： <code>Prettier - Code formatter</code>、<code>Vetur</code>、</li>
<li>规范检查：<code>ESLint</code>、<code>Stylelint</code>、<code>TSLint（已废弃）</code></li>
<li>标签自动化三剑客:<code>Auto Rename Tag</code>、<code>Auto Close Tag</code>、<code>Auto Import</code></li>
<li>css:<code>CSS Modules</code></li>
<li>代码片段：<code>ES7+ React/Redux/React-Native snippets</code>、<code>HTML CSS Support</code>、<code>JavaScript (ES6) code snippets</code></li>
<li>Markdown 预览：<code>Markdown Preview Enhanced</code>、<code>Markdown All in One</code>、<code>markdownlint</code></li>
<li>单词拼写：<code>Code Spell Checker</code></li>
<li>log 打印:<code>Turbo Console Log</code></li>
<li>浏览器打开：<code>open in browser</code></li>
<li>主题：<code>GitHub Theme</code></li>
<li>图片预览：<code>Image Preview</code></li>
<li>快速生成注释：<code>koroFileHeader</code></li>
<li>路径提示： <code>Path Intellisense</code>、</li>
<li>npm 模块导入智能提示： <code>npm Intellisense</code></li>
<li>接口请求：<code>REST Client</code></li>
<li>SSH：<code>Remote-SSH</code>、<code>Visual Studio Code Remote - SSH: Editing Configuration Files</code>、<code>Remote Explorer</code></li>
<li>错误显示：<code>Error Lens</code></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.baidu.com/2021/06/12/20-11-33/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KK">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KK">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/12/20-11-33/" class="post-title-link" itemprop="url">NodeJs</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-12 20:11:33" itemprop="dateCreated datePublished" datetime="2021-06-12T20:11:33+08:00">2021-06-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-18 23:14:13" itemprop="dateModified" datetime="2023-03-18T23:14:13+08:00">2023-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index"><span itemprop="name">web</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="NodeJs"><a href="#NodeJs" class="headerlink" title="NodeJs"></a>NodeJs</h1><h2 id="Node-js-模块化开发"><a href="#Node-js-模块化开发" class="headerlink" title="Node.js 模块化开发"></a>Node.js 模块化开发</h2><p>Node.js 规定一个 Javascript 文件就是一个模块，模块内部定义的变量和函数默认情况下外部无法得到。<br>模块内部可以使用 exports 对象进行成员导出，使用 require 方法导入其他模块。</p>
<h3 id="模块成员导出"><a href="#模块成员导出" class="headerlink" title="模块成员导出"></a>模块成员导出</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//a.js</span></span><br><span class="line"><span class="comment">//在模块中定义变量</span></span><br><span class="line"><span class="keyword">let</span> version = <span class="number">1.0</span>;</span><br><span class="line"><span class="comment">//模块中定义方法</span></span><br><span class="line"><span class="keyword">const</span> sayHi = <span class="function">(<span class="params">name</span>) =&gt;</span> <span class="string">`hello！<span class="subst">$&#123;name&#125;</span>`</span>; <span class="comment">//es6新语法</span></span><br><span class="line"><span class="comment">//向模块外部导出数据</span></span><br><span class="line"><span class="built_in">exports</span>.version = version;</span><br><span class="line"><span class="built_in">exports</span>.sayHi = sayHi;</span><br></pre></td></tr></table></figure>

<h3 id="模块成员的导入"><a href="#模块成员的导入" class="headerlink" title="模块成员的导入"></a>模块成员的导入</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//b.js</span></span><br><span class="line"><span class="comment">//在b.js模块中导入模块a</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="built_in">require</span>(<span class="string">&quot;./b.js&quot;</span>);</span><br><span class="line"><span class="comment">//输出b模块中的version变量</span></span><br><span class="line"><span class="built_in">console</span>.log(a.version);</span><br><span class="line"><span class="comment">//调用b模块中的sayHi方法</span></span><br><span class="line"><span class="built_in">console</span>.log(a.sayHi(<span class="string">&quot;XiaoMing&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>模块成员导出的另一种方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports.version = version;</span><br><span class="line"><span class="built_in">module</span>.exports.sayHi = sayHi;</span><br></pre></td></tr></table></figure>

<p>exports 是 module.exports 的别名，导出对象最终以 module.exports 为准；</p>
<h2 id="package-json-文件的作用"><a href="#package-json-文件的作用" class="headerlink" title="package.json 文件的作用"></a>package.json 文件的作用</h2><p>项目描述文件，记录了当前项目信息。如：项目版本、作者、依赖的模块等等；使用<code>npm init -y</code>生成。其作用为（一）锁定包的版本，确保再次下载时不会因为包版本不同而产生问题。（二）加快下载速度，其记录着依赖的下载地址。</p>
<ul>
<li>开发依赖</li>
</ul>
<p>在项目开发阶段所需要的依赖，线上运营阶段不需要依赖的第三方包,称为开发依赖；可使用<code>npm install 包名 --save-dev</code>将包添加到 package.json 文件的 devDependencies 字段中</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;gulp&quot;</span>: <span class="string">&quot;^3.9.1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Node-js-中模块的加载机制"><a href="#Node-js-中模块的加载机制" class="headerlink" title="Node.js 中模块的加载机制"></a>Node.js 中模块的加载机制</h2><p>模块查找规则</p>
<ul>
<li>当模块有路径没后缀时</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">require(&#x27;./find.js);</span><br><span class="line">require(&#x27;./find&#x27;);</span><br></pre></td></tr></table></figure>

<ol>
<li>require 方法根据路径查找模块</li>
<li>如果模块后缀省略，则先找同名 JS 文件再找同名 JS 文件夹</li>
<li>如果找到同名文件夹，则继续寻找其中的 index.js 文件</li>
<li>如果没有 index.js 文件，就会去当前文件夹中的 package.js 文件中查找 main 选项中的入口文件</li>
<li>如果入口文件不存在或没有指定入口文件，则报错：模块未找到</li>
</ol>
<ul>
<li>当模块即没路径也没后缀时</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">require(&quot;find&quot;);</span><br></pre></td></tr></table></figure>

<ol>
<li>Node.js 会假设它是系统模块，会去 node_modules 文件中寻找</li>
<li>先查看是否有同名 js 文件</li>
<li>在看有没有同名文件夹</li>
<li>若有，则继续寻找其中的 index.js 文件</li>
<li>如没有，则查看该文件夹中的 package.json 中的 main 选项确定模块的入口文件</li>
<li>若都没有，则报错</li>
</ol>
<h2 id="系统模块-Node-运行环境提供的-API"><a href="#系统模块-Node-运行环境提供的-API" class="headerlink" title="系统模块:Node 运行环境提供的 API"></a>系统模块:Node 运行环境提供的 API</h2><h3 id="fs-文件操作"><a href="#fs-文件操作" class="headerlink" title="fs 文件操作"></a>fs 文件操作</h3><p><code>const fs=require(&#39;fs&#39;);</code></p>
<p>读取文件内容:<code>fs.readFile(&#39;文件路径/文件名&#39;[,&#39;文件编码&#39;],callback);</code>(括号内为可选项)</p>
<p>实例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//读取上一级css目录下的base.css</span></span><br><span class="line">fs.readFile(<span class="string">&quot;../css/base.css&quot;</span>, <span class="string">&quot;utf-8&quot;</span>, <span class="function">(<span class="params">err, doc</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//如果读取错误参数err的值为错误对象，否则err的值为null</span></span><br><span class="line">  <span class="comment">//doc参数为文件内容</span></span><br><span class="line">  <span class="keyword">if</span> (err == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">//控制台中输出文件内容</span></span><br><span class="line">    <span class="built_in">console</span>.log(doc);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>写入文件内容：`fs.writeFile(‘文件路径/文件名称’,’数据’,callback);</p>
<p>实例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> conetent = <span class="string">&quot;&lt;h3&gt;!!!!!!!!!!&lt;/h3&gt;&quot;</span>;</span><br><span class="line">fs.writeFile(<span class="string">&quot;../index.html&quot;</span>, content, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;文件写入成功&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fs.stat(file, <span class="function">(<span class="params">err,data</span>)=&gt;</span>&#123;&#125;) <span class="comment">//查询文件状态（data.isFile()–判断是否是文件，isDirectory()–判断是否是文件夹）</span></span><br><span class="line">fs.mkdir(fileName,<span class="function"><span class="params">err</span> =&gt;</span> &#123;&#125;)<span class="comment">// 创建文件夹 （fileName–文件夹名称，重复会报错，例如：’./test‘），注意：此方法不能连续创建文件夹，例如：/test/one/two</span></span><br><span class="line">fs.readdir(fileName,<span class="function"><span class="params">err</span> =&gt;</span> &#123;&#125;)<span class="comment">//读取文件夹，返回文件夹的所有直系子文件名称，移动文件位置等</span></span><br><span class="line">fs.rename(newFileName,oldFileName,<span class="function"><span class="params">err</span> =&gt;</span> &#123;&#125;)<span class="comment">//修改文件夹、文件的名称</span></span><br><span class="line">fs.writeFile(file,<span class="function"><span class="params">err</span>=&gt;</span> &#123;&#125;)<span class="comment">// 创建文件 （file—应路径下的文件,包括文件名，例如：’./test/test.txt‘ ，如文件已存在，会覆盖原文件内容）</span></span><br><span class="line">fs.appendFile(file,<span class="function"><span class="params">err</span>=&gt;</span> &#123;&#125;)<span class="comment">// 追加文件内容，会在文件内容末尾追加（若文件不存在，回先自动创建，类似于writeFile）</span></span><br><span class="line">fs.readFile(file,’utf-<span class="number">8</span>‘，(err,data)=&gt;&#123;&#125;)<span class="comment">// 读取文件内容，不设置格式，会返回Buffer数据，需要设置格式，例如utf-8，或者通过data.toString()进行转化</span></span><br><span class="line">fs.unlink(file,<span class="function"><span class="params">err</span>=&gt;</span> &#123;&#125;)<span class="comment">// 删除文件</span></span><br><span class="line">fs.rmdir(file,<span class="function"><span class="params">err</span>=&gt;</span> &#123;&#125;) <span class="comment">//删除文件夹，若文件夹下有文件，会报错，只能删除空文件夹</span></span><br><span class="line"><span class="comment">//注：若要连续创建文件夹，可以下载mkdirp模块包，mkdirp(&#x27;./one/two/three&#x27;) 既可以创建连续目录。（目前测试不支持创建文件，写入内容，npm地址:https://www.npmjs.com/package/mkdirp）</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="fs-流操作"><a href="#fs-流操作" class="headerlink" title="fs 流操作"></a>fs 流操作</h3><ul>
<li>写入流 createWriteStream</li>
<li>读取流 createReadStream</li>
<li>管道流 pipe</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">writeStr: <span class="function">(<span class="params">str</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 需要先创建流</span></span><br><span class="line">  <span class="keyword">const</span> writeStream = fs.createWriteStream(<span class="string">&quot;./test.txt&quot;</span>);</span><br><span class="line">  writeStream.write(str); <span class="comment">// str为写入内容</span></span><br><span class="line">  writeStream.end(); <span class="comment">// 此句必须写，不然无法触发下面的finish事件</span></span><br><span class="line">  writeStream.on(<span class="string">&quot;finish&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;写入完成&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------------------------------------------------------------------------------------------/-------/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> str = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> readStream = fs.createReadStream(<span class="string">&quot;./test.txt&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(readStream);</span><br><span class="line">readStream.on(<span class="string">&quot;data&quot;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  str += data;</span><br><span class="line">  count++;</span><br><span class="line">&#125;);</span><br><span class="line">readStream.on(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(str, <span class="string">&quot;str----&quot;</span>, count);</span><br><span class="line">&#125;);</span><br><span class="line">readStream.on(<span class="string">&quot;err&quot;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err, <span class="string">&quot;err----&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------------------------------------------------------------------------------------------/-------/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> readStream = fs.createReadStream(<span class="string">&quot;./test.txt&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> writeStream = fs.createWriteStream(<span class="string">&quot;./one.txt&quot;</span>);</span><br><span class="line"><span class="comment">// 将读取的test文件内容，写入到one，one如有内容，会被覆盖</span></span><br><span class="line">readStream.pipe(writeStream);</span><br></pre></td></tr></table></figure>

<h3 id="路径拼接"><a href="#路径拼接" class="headerlink" title="路径拼接"></a>路径拼接</h3><p><code>path.join(&#39;路径&#39;,&#39;路径&#39;,..);</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入path模块</span></span><br><span class="line"><span class="keyword">const</span> path=<span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="comment">//路径拼接</span></span><br><span class="line"><span class="keyword">let</span> finialPath=path.join(<span class="string">&#x27;itcast&#x27;</span>,<span class="string">&#x27;a,&#x27;</span>css<span class="string">&#x27;,&#x27;</span>test.css<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">//输出</span></span><br><span class="line"><span class="string">console.log(finialPath);</span></span><br><span class="line"><span class="string">//用__dirname获取当前文件的绝对路径</span></span><br><span class="line"><span class="string">const fs=require(&#x27;</span>fs<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">fs.readFile(path.join(__dirname,&#x27;</span>test.css<span class="string">&#x27;),&#x27;</span>utf-<span class="number">8</span><span class="string">&#x27;,(err,doc)=&gt;&#123;</span></span><br><span class="line"><span class="string">console.log(err);</span></span><br><span class="line"><span class="string">console.log(doc);</span></span><br><span class="line"><span class="string">&#125;);</span></span><br></pre></td></tr></table></figure>

<h2 id="第三方模块"><a href="#第三方模块" class="headerlink" title="第三方模块"></a>第三方模块</h2><p>npm(node package manager):node 的第三方模块管理工具</p>
<ul>
<li>下载：<code>npm install 模块名</code></li>
<li>卸载：<code>npm uninstall package 模块名</code></li>
</ul>
<p>全局安装和本地安装：一般命令行工具全局安装，库文件本地安装</p>
<h3 id="第三方模块-mine"><a href="#第三方模块-mine" class="headerlink" title="第三方模块 mine"></a>第三方模块 mine</h3><p>其中 mine.getType(路径);可根据路径返回请求的文件类型;可用于 res.writeHead(200,{‘content-type’:’text/css;charset=utf8’})</p>
<h3 id="第三方模块-art-template-模板引擎"><a href="#第三方模块-art-template-模板引擎" class="headerlink" title="第三方模块 art-template 模板引擎"></a>第三方模块 art-template 模板引擎</h3><ol>
<li><p>下载：<code>npm install art-template</code></p>
</li>
<li><p>引入：<code>const template = require(&#39;art-template&#39;);</code></p>
</li>
<li><p>告诉模板引擎要拼接的数据和模板地址:<code>const html=template(&#39;模板数据&#39;,数据);</code></p>
</li>
</ol>
<p>实例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入模块</span></span><br><span class="line"><span class="keyword">const</span> template = <span class="built_in">require</span>(<span class="string">&#x27;art-template&#x27;</span>);</span><br><span class="line"><span class="comment">//拼接</span></span><br><span class="line"><span class="keyword">const</span> html=template(<span class="string">&#x27;./index.art&#x27;</span>,&#123;</span><br><span class="line"><span class="attr">data</span>:&#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;xioaming&#x27;</span>,</span><br><span class="line"><span class="attr">age</span>: <span class="number">29</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//index.art</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;data.name&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;data.age&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>模板语法</p>
<ul>
<li><p>数据输出<br>标准语法：<code>&#123;&#123;数据&#125;&#125;</code><br>原始语法：<code>&lt;%=数据%&gt;</code></p>
</li>
<li><p>原文输出：数据中带有 HTML 标签，默认情况下模板引擎不会解析标签,会转义后输出,若要解析则<br>标准语法：<code>&#123;&#123;@数据&#125;&#125;</code><br>原始语法：<code>&lt;%-数据%&gt;</code></p>
</li>
<li><p>条件判断<br>标准语法：<code>&#123;&#123;if 条件&#125;&#125;....&#123;&#123;else if 条件&#125;&#125;....&#123;&#123;/if&#125;&#125;</code><br>原始语法：<code>&lt;%if (条件) &#123;%>....<%&#125; else if(条件) &#123;%>....<%&#125;  %&gt;</code></p>
</li>
<li><p>循环<br>标准语法：<code>&#123;&#123;each 数据&#125;&#125; &#123;&#123;$index&#125;&#125; &#123;&#123;$value&#125;&#125;  &#123;&#123;/each&#125;&#125;</code><br>原始语法：<code>&lt;% for() &#123;%> ....<%&#125; %&gt;</code></p>
</li>
</ul>
</li>
<li><p>子模板</p>
</li>
</ul>
<p>将网站的公共区域（头部、页脚）抽离到单独文件中<br>标准语法：<code>&#123;include &#39;模板路径/footer.art&#39;&#125;</code><br>原始语法：<code>&lt;%include(&#39;模板路径&#39;)%&gt;</code></p>
<ul>
<li>模板继承</li>
</ul>
<p>将网站 HTML 骨架抽离到单独文件中，其他页面模板可以继承</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">!&lt;DOCTYPE HTML&gt;</span><br><span class="line">  &lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">      &lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">      &lt;title&gt;骨架模板&lt;/title&gt;</span><br><span class="line">      &#123;&#123;block &#x27;head&#x27;&#125;&#125; &#123;&#123;/block&#125;&#125;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">      &#123;&#123;block &#x27;content&#x27;&#125;&#125; &#123;&#123;/block&#125;&#125;</span><br><span class="line">      &lt;!--预留位置--&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">  &lt;/html&gt;&lt;/DOCTYPE</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>模板继承</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;extend <span class="string">&#x27;./test.art&#x27;</span>&#125;&#125;</span><br><span class="line">&#123;&#123;block <span class="string">&#x27;head&#x27;</span>&#125;&#125; &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;test.css&quot;</span>&gt; &#123;&#123;/block&#125;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>模板配置</p>
<ol>
<li>向模板中导入变量<code>template.default.imports.变量名=变量值(第三方模板的方法);</code> 在模板 test.art 中使用<code>&#123;&#123;dateFormat(time,'yyyy-mm-dd')&#125;&#125;</code></li>
<li>设置模板根目录<code>template.defaults.root=模板目录</code></li>
<li>设置模板默认后缀<code>template.defaults.extname=&#39;.art&#39;</code></li>
</ol>
</li>
</ul>
<h3 id="第三方模块-router"><a href="#第三方模块-router" class="headerlink" title="第三方模块 router"></a>第三方模块 router</h3><p>功能：实现路由<br>使用步骤：获取路由对象；调用路由对象提供的方法创建路由；启用路由；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getRouter = <span class="built_in">require</span>(<span class="string">&quot;router&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> router = getRounter();</span><br><span class="line">router.get(<span class="string">&quot;/add&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.end(<span class="string">&quot;hello world!&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">server.on(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  router(req, res);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="第三方模块-serve-static"><a href="#第三方模块-serve-static" class="headerlink" title="第三方模块 serve-static"></a>第三方模块 serve-static</h3><p>功能：静态资源访问服务</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> serverStatic = <span class="built_in">require</span>(<span class="string">&quot;serve-static&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> serve = serverStatic(<span class="string">&quot;./pulic&quot;</span>);</span><br><span class="line">serve.on(<span class="string">&quot;request&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  serve(req, res);</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<h3 id="第三方模块-Express-框架"><a href="#第三方模块-Express-框架" class="headerlink" title="第三方模块 Express 框架"></a>第三方模块 Express 框架</h3><p>基于 node 平台的 web 应用开发框架，可使用<code>npm install express</code>下载</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引用框架</span></span><br><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">//创建网站服务器</span></span><br><span class="line"><span class="keyword">const</span> app=express();</span><br><span class="line"></span><br><span class="line"><span class="comment">//当客户端以get方式访问/时</span></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req.res</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="comment">//获取get参数</span></span><br><span class="line"><span class="built_in">console</span>.log(req.query);</span><br><span class="line"><span class="comment">//响应:sen方法会自动设置http状态码，响应头部,类型</span></span><br><span class="line">res.send(<span class="string">&#x27;hello!!!!&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//当客户端以post方式访问/add时</span></span><br><span class="line">app.post(<span class="string">&#x27;/add&#x27;</span>,<span class="function">(<span class="params">req.res</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="comment">//获取post参数：需要第三方模块body-parser</span></span><br><span class="line"><span class="built_in">console</span>.log(req.body);</span><br><span class="line">res.send(<span class="string">&#x27;hello!!!!&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;server is runningn ...&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>第三方模块 body-parser</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&quot;body-parser&quot;</span>);</span><br><span class="line"><span class="comment">//配置body-parser模块</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extender</span>: <span class="literal">false</span> &#125;));</span><br><span class="line"><span class="comment">//接收请求</span></span><br><span class="line">app.post(<span class="string">&quot;/add&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.body);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>构建模块化路由</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="comment">//创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> home = express.Router();</span><br><span class="line"><span class="comment">//将路由和请求路径进行匹配</span></span><br><span class="line">app.use(<span class="string">&quot;/home&quot;</span>, home);</span><br><span class="line"><span class="comment">//在home路由下继续创建路由</span></span><br><span class="line">home.get(<span class="string">&quot;/index&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 响应/home/index</span></span><br><span class="line">  res.send(<span class="string">&quot;welcome&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>参数路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//服务端</span></span><br><span class="line">app.get(<span class="string">&quot;/find/:id&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.params); <span class="comment">//&#123;id:124&#125;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//客户端</span></span><br><span class="line">localhost: <span class="number">3000</span> / find / <span class="number">124</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>中间件:将客户端发来的请求进行拦截处理</li>
</ul>
<p>如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&quot;请求地址&quot;</span>, <span class="string">&quot;处理函数&quot;</span>);</span><br><span class="line">app.post(<span class="string">&quot;请求地址&quot;</span>, <span class="string">&quot;处理函数&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>针对一个请求可设置多个中间件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//next方法：该中间件处理后会将请求的控制权交给下一个中间件</span></span><br><span class="line">  req.name = <span class="string">&quot;xiaoming&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.name);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>app.use 中间件用法</li>
</ul>
<p>会匹配所有的请求方法,直接传入请求处理函数代表接收所有请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.url);</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>用于错误处理</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/index&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line"> <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;程序发生未知错误&#x27;</span>); <span class="comment">//易出现错误的地方</span></span><br><span class="line">&#125;);</span><br><span class="line">app.use(<span class="function">(<span class="params">err,req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line"> res.status(<span class="number">500</span>).send(err.message); <span class="comment">//只能用于处理同步代码错误</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//异步代码错误需要手动触发错误</span></span><br><span class="line">app.get(<span class="string">&#x27;/index&#x27;</span>,<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line"> fs.readFile(<span class="string">&#x27;./test.c&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>,<span class="function">(<span class="params">err,data</span>)=&gt;</span>&#123;</span><br><span class="line"> <span class="keyword">if</span>(err)&#123;</span><br><span class="line"> next(err); <span class="comment">//易出现错误的地方</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;&#125;);</span><br><span class="line">app.use(<span class="function">(<span class="params">err,req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line"> res.status(<span class="number">500</span>).send(err.message); <span class="comment">//只能用于处理同步代码错误</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>静态资源的处理</li>
</ul>
<p>通过 express 内置的 express.static 托管静态文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(express.static(<span class="string">&quot;./pulic&quot;</span>));</span><br></pre></td></tr></table></figure>

<ul>
<li>express 模板引擎</li>
</ul>
<p>在原 art-template 模板引擎的基础上进行封装:<code>npm install art-template express-art-template</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当渲染后缀为art的模板时，使用express-art-template</span></span><br><span class="line">app.engine(<span class="string">&quot;art&quot;</span>, <span class="built_in">require</span>(<span class="string">&quot;express-art-template&quot;</span>));</span><br><span class="line"><span class="comment">//设置模板存放目录</span></span><br><span class="line">app.set(<span class="string">&quot;views&quot;</span>, path.jon(__dirname, <span class="string">&quot;views&quot;</span>));</span><br><span class="line"><span class="comment">//渲染模板时不写后缀，默认拼接art后缀</span></span><br><span class="line">app.set(<span class="string">&quot;view engine&quot;</span>, <span class="string">&quot;art&quot;</span>);</span><br><span class="line"><span class="comment">//渲染模板</span></span><br><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.render(<span class="string">&quot;index&quot;</span>, &#123; <span class="attr">mes</span>: <span class="string">&quot;模板数据&quot;</span> &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>将变量设置到 app.locals 对象下，则所有的模板都可以获取到</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">app.locals.users = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//users是自定义的</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;xiaoming&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">22</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;xiaomei&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h3 id="第三方模块-Gulp"><a href="#第三方模块-Gulp" class="headerlink" title="第三方模块 Gulp"></a>第三方模块 Gulp</h3><p>功能：项目上线，HTML、CSS、JS 文件压缩合并，语法转换（es6、less）</p>
<p>使用：</p>
<ul>
<li>使用<code>npm install gulp</code>下载 gulp 库文件</li>
<li>在项目根目录下建立 gulpfile.js 文件</li>
<li>重构项目的文件夹结构 src 目录放置源代码文件，dist 目录放置构建后文件</li>
<li>在 gulpfile.js 文件中编写任务</li>
<li>在命令行工具中执行 gulp 任务</li>
</ul>
<p>gulp 提供的方法：</p>
<ul>
<li>gulp.src():获取任务要处理的文件</li>
<li>gulp.dest():输出文件</li>
<li>gulp.task():建立 gulp 任务</li>
<li>gulp.watch():监控文件的变化</li>
</ul>
<p>gulp 插件：</p>
<ul>
<li>gulp-htmlminn: html 文件压缩</li>
<li>gulp-csso: css 文件压缩</li>
<li>gulp-babel: javascript 语法转化</li>
<li>gulp-less: less 语法转化</li>
<li>gulp-uglify: 压缩混淆 JavaScript</li>
<li>gulp-file-include:公共文件包含</li>
<li>browsersync:浏览器实时同步</li>
</ul>
<h2 id="HTTP-协议"><a href="#HTTP-协议" class="headerlink" title="HTTP 协议"></a>HTTP 协议</h2><p>超文本传输协议。规定了客户端（浏览器）与服务器（网站服务器）之间请求和应答的标准</p>
<ul>
<li>静态资源：服务器不需要处理，可以直接响应给客户端的资源，如：css，JavaScript，image 文件</li>
<li>动态资源：相同的请求地址，不同的响应资源</li>
</ul>
<h3 id="报文"><a href="#报文" class="headerlink" title="报文"></a>报文</h3><p>在 HTTP 请求和响应的过程中传递的数据块叫做报文</p>
<ul>
<li><p>请求报文</p>
<ol>
<li>请求方式：GET、POST</li>
<li>请求地址</li>
<li>请求参数</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.on(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  req.headers; <span class="comment">//请求报文</span></span><br><span class="line">  req.url; <span class="comment">//请求地址</span></span><br><span class="line">  req.method; <span class="comment">//请求方法</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>响应报文</p>
<ol>
<li>HTTP 状态码： 200(请求成功)、400(客户端请求语法有误)、404(请求的资源未找到)、500(服务器错误)、</li>
<li>内容类型：<ul>
<li>text/html</li>
<li>text/css</li>
<li>application/javascript</li>
<li>image/jpeg</li>
<li>application/json</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>指客户端请求地址,如：<code>http://localhost:8080/index</code>与服务端程序代码的对应关系，即请求什么响应什么；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">app.on(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//获取客户端的请求路径</span></span><br><span class="line">  <span class="keyword">let</span> &#123; pathname &#125; = url.parse(req.url);</span><br><span class="line">  <span class="comment">//或写成</span></span><br><span class="line">  <span class="comment">//let pathname=url.parse(req.url).pathname;</span></span><br><span class="line">  <span class="keyword">if</span> (pathname == <span class="string">&quot;/&quot;</span> || pathname == <span class="string">&quot;/index&quot;</span>) &#123;</span><br><span class="line">    res.end(<span class="string">&quot;欢迎来到首页&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.end(<span class="string">&quot;页面不存在&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="创建-web-服务器"><a href="#创建-web-服务器" class="headerlink" title="创建 web 服务器"></a>创建 web 服务器</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引用系统模块</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">//创建web服务器</span></span><br><span class="line"><span class="keyword">const</span> app = http.createServer();</span><br><span class="line"><span class="comment">//当客户端发送请求的时候</span></span><br><span class="line">app.on(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//响应</span></span><br><span class="line"></span><br><span class="line">  res.end(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//返回状态码和返回资源类型,若无，低级浏览器可能出问题</span></span><br><span class="line"></span><br><span class="line">  res.writeHead(<span class="number">400</span>, &#123; <span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;text/html;charset=utf8&quot;</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听端口</span></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Server is running....&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>完善：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引用系统模块</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>); <span class="comment">//处理url地址模块</span></span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&quot;querystring&quot;</span>); <span class="comment">//处理参数模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建web服务器</span></span><br><span class="line"><span class="keyword">const</span> app = http.createServer();</span><br><span class="line"></span><br><span class="line"><span class="comment">//当客户端发送请求的时候</span></span><br><span class="line">app.on(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//post参数是通过事件的方式接受的</span></span><br><span class="line">  <span class="comment">//data当请求参数传递的时候发出data事件</span></span><br><span class="line">  <span class="comment">//end当参数传递完成的时候时发出end事件</span></span><br><span class="line">  <span class="comment">//获取POST参数需要使用data事件和end事件；</span></span><br><span class="line">  <span class="keyword">let</span> postParams = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  req.on(<span class="string">&quot;data&quot;</span>, <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">    postParams += params; <span class="comment">//接收的数据不是一次性发完的</span></span><br><span class="line">  &#125;);</span><br><span class="line">  req.on(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(postParams);</span><br><span class="line">    <span class="built_in">console</span>.log(querystring.parse(postParams)); <span class="comment">//将参数转换为对象格式</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//响应</span></span><br><span class="line">  res.end(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//返回状态码和相关信息</span></span><br><span class="line"></span><br><span class="line">  res.writeHead(<span class="number">400</span>, &#123; <span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;text/html;charset=utf8&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//调用url模块方法parse();第一个参数为要处理的地址，第二个参数为是否处理为对象格式，true为是；</span></span><br><span class="line">  <span class="built_in">console</span>.log(url.parse(res.url, <span class="literal">true</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听端口</span></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Server is running....&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Node-js-异步编程"><a href="#Node-js-异步编程" class="headerlink" title="Node.js 异步编程"></a>Node.js 异步编程</h2><ul>
<li>同步 api:当前 api 执行完成后，才能继续执行下一个 api;同步代码执行完后才开始执行异步代码，再执行回调函数</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//同步api可以从返回值中拿到api执行结果，而异步api不行</span></span><br><span class="line"></span><br><span class="line">funciotn <span class="function"><span class="title">sum</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> x+y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> re=sum(<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//异步</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMsg</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> &#123;<span class="attr">msg</span>:<span class="string">&#x27;hello&#x27;</span>&#125;,<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> res=getMsg(); <span class="comment">//undefined</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>异步 api:当前 api 的执行，不会阻塞后续代码的执行;异步 api 通过回调函数获取返回值</li>
</ul>
<blockquote>
<p>回调函数：自己定义函数让别人去调用</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  callback(<span class="string">&quot;XiaoMing&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getData(<span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;hello&quot;</span> + n);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>promise 解决回调地狱问题</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ler promise=<span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">resolve(&#123;<span class="attr">name</span>:<span class="string">&#x27;xiaoming&#x27;</span>&#125;);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">reject(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;,<span class="number">2000</span>);</span><br><span class="line">&#125;):</span><br><span class="line">promise.then(<span class="function"><span class="params">result</span>=&gt;</span><span class="built_in">console</span>.log(result);<span class="comment">//&#123;name:&#x27;xioaming&#x27;&#125;).catch(error=&gt;console.log(error);//error);</span></span><br></pre></td></tr></table></figure>

<ul>
<li>异步函数：终极方案，让异步代码写成同步代码形式，让代码不再有回调函数嵌套</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在普通函数定义前加上async关键字</span></span><br><span class="line"><span class="comment">//异步函数默认返回的时promise对象</span></span><br><span class="line"><span class="comment">//在异步函数使用throw关键字进行错误抛出，之后的代码将不会执行</span></span><br><span class="line"><span class="keyword">const</span> fn = <span class="keyword">async</span> () =&gt; &#123;&#125;;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ok;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(fn());</span><br><span class="line">fn().then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//awaite关键字只能出现在异步函数中</span></span><br><span class="line"><span class="comment">//awaite promise对象； 暂停异步函数的执行，等待promise对象返回结果后在向下执行</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">await</span> p1();</span><br><span class="line">  <span class="keyword">await</span> p2();</span><br><span class="line">  <span class="keyword">await</span> p3();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>返回 promise 对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用util模块的promisify方法</span></span><br><span class="line"><span class="keyword">const</span> fs=<span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> promisify=<span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>).promisify;</span><br><span class="line"><span class="keyword">const</span> readFile=pronisify(fs.readFile);</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> r1=awaite readFile(<span class="string">&#x27;./1.txt&#x27;</span>,<span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> r2=awaite readFile(<span class="string">&#x27;./2.txt&#x27;</span>,<span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(r1,r2);</span><br><span class="line">&#125;</span><br><span class="line">run();</span><br></pre></td></tr></table></figure>

<p>捕获错误:</p>
<p><code>try catch</code>可以捕获异步函数以及其他同步代码在执行过程中发生的错误，但不能捕获其他类型 api 发生的错误。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> User.fid(&#123; <span class="attr">name</span>: <span class="string">&quot;xiaoming&quot;</span> &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (er) &#123;</span><br><span class="line">    next(er);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="全局对象-global"><a href="#全局对象-global" class="headerlink" title="全局对象 global"></a>全局对象 global</h2><p>在浏览器中全局对象时 window,在 node 中全局对象是 global</p>
<p>Node 中的全局对象有以下方法，可省略 global：<code>console.log()</code>,<code>setTimeout()</code>,clearEimeout()<code>,</code>setInternal()<code>,</code>clearInterval`</p>
<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><p>存储数据的仓库：mysql、MongoDB、Oracle</p>
<p>相关概念：</p>
<table>
<thead>
<tr>
<th>术语</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>database</td>
<td>数据仓库,可建立多个数据库</td>
</tr>
<tr>
<td>collection</td>
<td>集合，一组数据的集合</td>
</tr>
<tr>
<td>document</td>
<td>文档，一条具体的数据</td>
</tr>
<tr>
<td>field</td>
<td>字段,文档中的属性名称</td>
</tr>
</tbody></table>
<h3 id="第三方包-Mongoose"><a href="#第三方包-Mongoose" class="headerlink" title="第三方包 Mongoose"></a>第三方包 Mongoose</h3><p>使用 node.js 操作 MongoDB 数据库,下载<code>npm install mongoose</code></p>
<ul>
<li>数据库的连接</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>);</span><br><span class="line">mongoose</span><br><span class="line">  .connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br><span class="line">  .then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;数据库连接成功&quot;</span>))</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;fail!&quot;</span>, err));</span><br></pre></td></tr></table></figure>

<ul>
<li>创建数据库</li>
</ul>
<p>在 MongoDB 中不需要显示创建数据库，如果使用的数据库不存在，MongoDB 会自动创建。</p>
<h4 id="MongoDB-增删查改操作"><a href="#MongoDB-增删查改操作" class="headerlink" title="MongoDB 增删查改操作"></a>MongoDB 增删查改操作</h4><ul>
<li>创建集合</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对集合设定规则</span></span><br><span class="line"><span class="keyword">const</span> courseSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">String</span>,</span><br><span class="line">  <span class="attr">author</span>: <span class="built_in">String</span>,</span><br><span class="line">  <span class="attr">isPublished</span>: <span class="built_in">Boolean</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//创建集合并合并规则</span></span><br><span class="line"><span class="keyword">const</span> Course = mongoose.model(<span class="string">&quot;Course&quot;</span>, courseSchema); <span class="comment">//返回构造函数</span></span><br></pre></td></tr></table></figure>

<ul>
<li>创建文档</li>
</ul>
<p>即向集合中插入元素</p>
<p>第一种方法:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建集合实例</span></span><br><span class="line"><span class="keyword">const</span> course=<span class="keyword">new</span> Course(&#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;tset&#x27;</span>,</span><br><span class="line"><span class="attr">author</span>: <span class="string">&#x27;xiaoming&#x27;</span></span><br><span class="line"><span class="attr">isPubulished</span>: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//保存数据</span></span><br><span class="line">course.save();</span><br></pre></td></tr></table></figure>

<p>第二种方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Course.create(&#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;tset&#x27;</span>,</span><br><span class="line"><span class="attr">author</span>: <span class="string">&#x27;xiaoming&#x27;</span></span><br><span class="line"><span class="attr">isPubulished</span>: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="function">(<span class="params">err,doc</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="comment">//错误对象</span></span><br><span class="line"><span class="built_in">console</span>.log(err);</span><br><span class="line"><span class="comment">//当前文档</span></span><br><span class="line"><span class="built_in">console</span>.log(doc);</span><br><span class="line">&#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//create返回的也是promise对象</span></span><br><span class="line">Course.create(&#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;tset&#x27;</span>,</span><br><span class="line"><span class="attr">author</span>: <span class="string">&#x27;xiaoming&#x27;</span></span><br><span class="line"><span class="attr">isPubulished</span>: <span class="literal">true</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">doc</span>=&gt;</span><span class="built_in">console</span>.log(doc)).catch(<span class="function"><span class="params">err</span>=&gt;</span><span class="built_in">console</span>.log(err));</span><br></pre></td></tr></table></figure>

<ul>
<li>mongoose 验证</li>
</ul>
<p>在创建集合规则时，可以设置当前字段的验证规则，验证失败则输入插入失败</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> postSchema=<span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line"> <span class="attr">title</span>:&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="built_in">String</span>,  <span class="comment">//字段类型</span></span><br><span class="line">  <span class="attr">required</span>: <span class="literal">true</span>  <span class="comment">//true时代表该字段必填,不能为空</span></span><br><span class="line">  <span class="attr">default</span>: <span class="string">&#x27;默认title&#x27;</span> <span class="comment">//默认值</span></span><br><span class="line">  <span class="attr">validate</span>:&#123;  <span class="comment">//自定义验证器</span></span><br><span class="line">  <span class="attr">validator</span>: <span class="function"><span class="params">v</span>=&gt;</span>&#123;</span><br><span class="line">   <span class="comment">//返回布尔值，true代表验证成功</span></span><br><span class="line">   <span class="comment">//v要验证的值</span></span><br><span class="line">   <span class="keyword">return</span> v.length&gt;<span class="number">4</span></span><br><span class="line">  &#125;</span><br><span class="line">   <span class="attr">masseage</span>: <span class="string">&#x27;error!!!!!&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"> <span class="attr">authod</span>:&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="built_in">String</span>,  <span class="comment">//字段类型</span></span><br><span class="line">  <span class="attr">trim</span>:<span class="literal">true</span> <span class="comment">//自动去除字符串两边的空格</span></span><br><span class="line">  <span class="attr">required</span>: [<span class="literal">true</span>,<span class="string">&#x27;错误信息&#x27;</span>], <span class="comment">//自定义错误信息</span></span><br><span class="line">  <span class="attr">minlength</span>: <span class="number">2</span>,  <span class="comment">//字符串最小长度</span></span><br><span class="line">  <span class="attr">maxlength</span>: [<span class="number">10</span>,<span class="string">&#x27;长度错误&#x27;</span>],  <span class="comment">//字符串最大长度</span></span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"> <span class="attr">age</span>:&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="built_in">Number</span>,</span><br><span class="line">  <span class="attr">min</span>: <span class="number">2</span>,  <span class="comment">//数值的最小值</span></span><br><span class="line">  <span class="attr">max</span>: <span class="number">100</span> <span class="comment">//数值的最大值</span></span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">category</span>:&#123;</span><br><span class="line">  <span class="attr">type</span>:<span class="built_in">String</span>,</span><br><span class="line">  <span class="attr">enum</span>:[<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;css&#x27;</span>,<span class="string">&#x27;js&#x27;</span>]  <span class="comment">//枚举,输入的值必须在其中,否则报错</span></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  enum:&#123;</span></span><br><span class="line"><span class="comment">   values: [&#x27;html&#x27;,&#x27;css&#x27;,&#x27;js&#x27;],</span></span><br><span class="line"><span class="comment">   message: &#x27;error message&#x27;</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Post=mongoose.model(<span class="string">&#x27;Post&#x27;</span>,postSchema);</span><br><span class="line">post.create(&#123;&#125;).then(<span class="function"><span class="params">re</span>=&gt;</span><span class="built_in">console</span>.log(re)).catch(<span class="function"><span class="params">err</span>=&gt;</span><span class="built_in">console</span>.log(err));</span><br></pre></td></tr></table></figure>

<ul>
<li><p>集合关联</p>
<ol>
<li>使用 id 对集合进行关联</li>
<li>使用 populate 方法进行关联集合查询</li>
</ol>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用户集合</span></span><br><span class="line"><span class="keyword">const</span> User=mongoose.model(<span class="string">&#x27;User&#x27;</span>,<span class="keyword">new</span> mongoose.Schema(&#123;<span class="attr">name</span>:&#123;<span class="attr">type</span>: <span class="built_in">String</span>&#125;&#125;));</span><br><span class="line"><span class="comment">//文章集合</span></span><br><span class="line"><span class="keyword">const</span> Post=mongoose.model(<span class="string">&#x27;Post&#x27;</span>,<span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line"> <span class="attr">title</span>:&#123;<span class="attr">type</span>: <span class="built_in">String</span>&#125;,</span><br><span class="line"><span class="comment">//使用id将文章集合和作者集合进行关联</span></span><br><span class="line"> <span class="attr">author</span>:&#123;<span class="attr">type</span>: mongoose.Schema.Types.ObjectId, <span class="attr">ref</span>: <span class="string">&#x27;User&#x27;</span>&#125;</span><br><span class="line">&#125;)):</span><br><span class="line"></span><br><span class="line"><span class="comment">//联合查询</span></span><br><span class="line">Post.find().populate(<span class="string">&#x27;author&#x27;</span>).then(<span class="function">(<span class="params">err,result</span>)=&gt;</span><span class="built_in">console</span>.log(result));</span><br></pre></td></tr></table></figure>

<ul>
<li>导入数据</li>
</ul>
<p>shell 命令：<code>mongoimport -d 数据库名称 -c 集合名称 -file 要导入的数据文件（josn格式）</code></p>
<ul>
<li>查询文档</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据条件查询文档，若为空则查询所有文档</span></span><br><span class="line">Course.find().then(<span class="function">(<span class="params">result</span>) =&gt;</span> <span class="built_in">console</span>.log(result)); <span class="comment">//返回的是文档的集合数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//实例</span></span><br><span class="line">Course.find(&#123; <span class="attr">name</span>: <span class="string">&quot;xiaoming&quot;</span> &#125;).then(<span class="function">(<span class="params">result</span>) =&gt;</span> <span class="built_in">console</span>.log(result));</span><br><span class="line">User.find(&#123; <span class="attr">age</span>: &#123; <span class="attr">$gt</span>: <span class="number">20</span>, <span class="attr">$lt</span>: <span class="number">50</span> &#125; &#125;).then(<span class="function">(<span class="params">result</span>) =&gt;</span> <span class="built_in">console</span>.log(result)); <span class="comment">//查询大于20小于50</span></span><br><span class="line">User.find(&#123; <span class="attr">hobbies</span>: &#123; <span class="attr">$in</span>: [<span class="string">&quot;运动&quot;</span>] &#125; &#125;).then(<span class="function">(<span class="params">result</span>) =&gt;</span> <span class="built_in">console</span>.log(result)); <span class="comment">//查询包含运动的</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//只查询一条数据</span></span><br><span class="line">Course.findOne(&#123; <span class="attr">name</span>: <span class="string">&quot;xiaoming&quot;</span> &#125;).then(<span class="function">(<span class="params">result</span>) =&gt;</span> <span class="built_in">console</span>.log(result));</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//选择要查询的字段</span></span><br><span class="line">User.find()</span><br><span class="line">  .select(<span class="string">&quot;name age -_id&quot;</span>)</span><br><span class="line">  .then(<span class="function">(<span class="params">result</span>) =&gt;</span> <span class="built_in">console</span>.log(result))</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="built_in">console</span>.log(err)); <span class="comment">//只返回查询的字段，不查询的字段前加-</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将查询出来的数据进行升序排序(从小到大）</span></span><br><span class="line">User.find()</span><br><span class="line">  .sort(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">  .then(<span class="function">(<span class="params">result</span>) =&gt;</span> <span class="built_in">console</span>.log(result));</span><br><span class="line"></span><br><span class="line"><span class="comment">//将查询出来的数据进行降序排序(从大到小）</span></span><br><span class="line">User.find()</span><br><span class="line">  .sort(<span class="string">&quot;-age&quot;</span>)</span><br><span class="line">  .then(<span class="function">(<span class="params">result</span>) =&gt;</span> <span class="built_in">console</span>.log(result));</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//skip跳过多条数据，limit限制查询数量</span></span><br><span class="line">User.find()</span><br><span class="line">  .skip(<span class="number">2</span>)</span><br><span class="line">  .limit(<span class="number">2</span>)</span><br><span class="line">  .then(<span class="function">(<span class="params">result</span>) =&gt;</span> <span class="built_in">console</span>.log(result)); <span class="comment">//分页查询时常用</span></span><br></pre></td></tr></table></figure>

<ul>
<li>删除文档</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除第一个文档</span></span><br><span class="line">Course.findOndeAndDelete(&#123;&#125;).then(<span class="function">(<span class="params">result</span>) =&gt;</span> <span class="built_in">console</span>.log(result)); <span class="comment">//返回删除的文档</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除多个文档</span></span><br><span class="line">User.deleteMany(&#123;&#125;).then(<span class="function">(<span class="params">result</span>) =&gt;</span> <span class="built_in">console</span>.log(result));</span><br></pre></td></tr></table></figure>

<ul>
<li>更新文档</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//更新单个</span></span><br><span class="line">User.updateOne(&#123; 查询条件 &#125;, &#123; 要修改的值 &#125;).then(<span class="function">(<span class="params">re</span>) =&gt;</span> <span class="built_in">console</span>.log(re));</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//更新多个</span></span><br><span class="line">User.updateMany(&#123; 查询条件 &#125;, &#123; 要修改的值 &#125;).then(<span class="function">(<span class="params">re</span>) =&gt;</span> <span class="built_in">console</span>.log(re));</span><br></pre></td></tr></table></figure>

<h4 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h4><h5 id="综合案例"><a href="#综合案例" class="headerlink" title="综合案例"></a>综合案例</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//301代表重定向</span></span><br><span class="line"><span class="comment">//location 跳转地址</span></span><br><span class="line">req.on(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  res.writeHead(<span class="number">301</span>, &#123;</span><br><span class="line">    <span class="attr">Location</span>: <span class="string">&quot;/list&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  res.end();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>npm i nodemon -g</code><br><code>nodemon test.js</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">KK</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">59</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/a913481180" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;a913481180" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:kangkanghuang@foxmail.com" title="E-Mail → mailto:kangkanghuang@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.baidu.com/" title="http:&#x2F;&#x2F;www.baidu.com">百度</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">KK</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
