<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/1.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/1.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.baidu.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":false,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="NPM一，包的安装&#x2F;更新&#x2F;卸载npm i 或者npm install装包,默认安装最新版本，直接npm i会安装package.json中 dependencies 的所有包 npm i xx@1.0安装指定版本 npm i -S 或者 npm i --save装包到生产环境（也就是上线后需要的依赖），在package.json的 dependencies 中生成版本信息 npm i -D 或者">
<meta property="og:type" content="article">
<meta property="og:title" content="前端包管理工具">
<meta property="og:url" content="http://www.baidu.com/2022/06/11/20-22-22/index.html">
<meta property="og:site_name" content="KK">
<meta property="og:description" content="NPM一，包的安装&#x2F;更新&#x2F;卸载npm i 或者npm install装包,默认安装最新版本，直接npm i会安装package.json中 dependencies 的所有包 npm i xx@1.0安装指定版本 npm i -S 或者 npm i --save装包到生产环境（也就是上线后需要的依赖），在package.json的 dependencies 中生成版本信息 npm i -D 或者">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-06-11T12:22:22.000Z">
<meta property="article:modified_time" content="2023-04-21T15:02:31.665Z">
<meta property="article:author" content="KK">
<meta property="article:tag" content="前端">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://www.baidu.com/2022/06/11/20-22-22/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>前端包管理工具 | KK</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">KK</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.baidu.com/2022/06/11/20-22-22/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="KK">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="KK">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          前端包管理工具
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-06-11 20:22:22" itemprop="dateCreated datePublished" datetime="2022-06-11T20:22:22+08:00">2022-06-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-21 23:02:31" itemprop="dateModified" datetime="2023-04-21T23:02:31+08:00">2023-04-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="NPM"><a href="#NPM" class="headerlink" title="NPM"></a>NPM</h2><h3 id="一，包的安装-更新-卸载"><a href="#一，包的安装-更新-卸载" class="headerlink" title="一，包的安装/更新/卸载"></a>一，包的安装/更新/卸载</h3><p><code>npm i</code> 或者<code>npm install</code>装包,默认安装最新版本，直接<code>npm i</code>会安装<code>package.json</code>中 dependencies 的所有包</p>
<p><code>npm i xx@1.0</code>安装指定版本</p>
<p><code>npm i -S</code> 或者 <code>npm i --save</code>装包到生产环境（也就是上线后需要的依赖），在<code>package.json</code>的 dependencies 中生成版本信息</p>
<p><code>npm i -D</code> 或者 <code>npm i --save-dev</code>装包到开发环境（也就是开发时需要的依赖），在<code>package.json</code>的 devDependencies 中生成版本信息</p>
<p><code>npm i xx@1.0 --save-exact</code>精确安装指定版本的包到生产环境。精确的意思就是，什么版本就是什么版本，版本号前面的<code>^</code>会消失掉。有<code>^</code> 代表是补丁版本</p>
<p><code>npm uninstall xx</code>卸载包</p>
<p><code>npm update xx@1.0</code>更新包，默认更新到最新</p>
<p><code>npm outdated</code>检查包是否过时，默认列出所有过时的包</p>
<p><code>npm i xx1@npm:xx@1</code><br><code>npm i xx2@npm:xx@2</code><br>安装同一个包的不同版本，如要引入 1 版本，则<code>import ‘xx1’</code>。<code>npm 6.9</code>及以后的版本可用</p>
<h3 id="二，信息查看"><a href="#二，信息查看" class="headerlink" title="二，信息查看"></a>二，信息查看</h3><p><code>npm ls</code>查看安装过的包，加<code>-g</code>就是查看全局安装过的包， <code>--depth 0</code>就是查看第一层，不再深入递归查询出子文件夹</p>
<p><code>npm ls 包名 -g</code>查看某个包，有则显示版本，没有则是 empty</p>
<p><code>npm root xx</code>查看包的安装路径</p>
<p><code>npm view xx versions</code>查看某个包在线上的所有版本</p>
<p>三，配置向<br><code>npm config set proxy=&quot;http://xx.com:8080&quot;</code>因为公司的防火墙原因，无法完成任何模块的安装，这个时候设置代理可以解决</p>
<p><code>npm config set registry=&quot;https://registry.npm.taobao.org&quot;</code>设置安装源，如上就是设置源为国内的淘宝镜像</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://npm.taobao.org/">https://npm.taobao.org</a> 和 <a target="_blank" rel="noopener" href="https://registry.npm.taobao.org/">https://registry.npm.taobao.org</a> 将在 2022.06.30 号正式下线和停止 DNS 解析。<br>新域名：<a target="_blank" rel="noopener" href="https://registry.npmmirror.com/">https://registry.npmmirror.com</a></p>
</blockquote>
<p>注意 npm 更换国内镜像源之后，将无法再使用 npm search 命令，需要恢复为官方源才可以使用，如果恢复官方源后还不可使用，运行删除注册表命令后重试即可。</p>
<p><code>npm config delete registry</code>// 删除注册表</p>
<p><code>npm config list -l</code>查看所有配置</p>
<h3 id="三-其它"><a href="#三-其它" class="headerlink" title="三, 其它"></a>三, 其它</h3><p><code>npm cache clean</code>清除 npm 本地缓存</p>
<p><code>npm init</code>初始化 package.json</p>
<p><code>npm start</code>启动指令,npm start 指令会匹配到 package 的 scripts 里的配置，然后启动对应脚本。start 此类的支持自定义，常见的自定义为 dev</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxx&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="四，发布自己的包"><a href="#四，发布自己的包" class="headerlink" title="四，发布自己的包"></a>四，发布自己的包</h3><h4 id="第一步：进入要发布的项目根目录，初始化为-npm-包"><a href="#第一步：进入要发布的项目根目录，初始化为-npm-包" class="headerlink" title="第一步：进入要发布的项目根目录，初始化为 npm 包"></a>第一步：进入要发布的项目根目录，初始化为 npm 包</h4><p><code>npm init</code></p>
<p>依次按提示填入包名、版本、描述、github 地址、关键字、license 等<br>这步完成之后会生成一个 package.json 文件，上面输入的这些信息可以在该文件中修改<br>name 是名字，不能和别人的一样，否则发布失败<br>version 是版本号，每次发布自己手动修改，版本号需递增，否则发布失败<br>main 设置入口文件，入口文件需和 package 同级，如不同级，则应该写/xx/yy 这样的相对路径，</p>
<p>注意：如果你的包引用了第三方包，则需要在 package.json 文件种增加 dependencies 节点，写入依赖的包及版本</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;colors&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.3.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;on-finished&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.3.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="第二步、注册-npm-用户，有两种方法-注册-npm-用户，有两种方法"><a href="#第二步、注册-npm-用户，有两种方法-注册-npm-用户，有两种方法" class="headerlink" title="第二步、注册 npm 用户，有两种方法 注册 npm 用户，有两种方法"></a>第二步、注册 npm 用户，有两种方法 注册 npm 用户，有两种方法</h4><p>方法一、npm 官网注册：npm</p>
<p>方法二、使用 npm 命令注册：npm adduser</p>
<h4 id="第三步、账号登录"><a href="#第三步、账号登录" class="headerlink" title="第三步、账号登录"></a>第三步、账号登录</h4><p><code>npm login</code></p>
<p>依次输入第二步中第一种方法注册的用户名、密码和邮箱</p>
<h4 id="第四步、发布包，上传到-npm-包服务器"><a href="#第四步、发布包，上传到-npm-包服务器" class="headerlink" title="第四步、发布包，上传到 npm 包服务器"></a>第四步、发布包，上传到 npm 包服务器</h4><p><code>npm publish</code></p>
<p>注意：如果报错：<code>&#39;You do not have permission to publish &quot;mypackage1&quot;. Are you logged in as the correct user?&#39;</code></p>
<p>表示包<code>mypackage1</code>已经在包管理器已经存在被别人用了，需要更该包名称</p>
<h3 id="五，更新一个已经发布的包"><a href="#五，更新一个已经发布的包" class="headerlink" title="五，更新一个已经发布的包"></a>五，更新一个已经发布的包</h3><h4 id="第一步、修改包的版本"><a href="#第一步、修改包的版本" class="headerlink" title="第一步、修改包的版本"></a>第一步、修改包的版本</h4><p>这次我在包根目录下新加了一个 index.js 文件</p>
<p><code>npm version patch</code> 该命令在原来的版本上自动加 1,实际上是将 package.json 文件中的 version 值修改了。</p>
<h4 id="第二步、重新发布包"><a href="#第二步、重新发布包" class="headerlink" title="第二步、重新发布包"></a>第二步、重新发布包</h4><p><code>npm publish</code></p>
<h3 id="六、删除包"><a href="#六、删除包" class="headerlink" title="六、删除包"></a>六、删除包</h3><p>1、删除指定的版本</p>
<p><code>npm unpublish 包名@版本号</code></p>
<p>2、删除整个包</p>
<p><code>npm unpublish 包名 --force</code></p>
<h2 id="YARN"><a href="#YARN" class="headerlink" title="YARN"></a>YARN</h2><blockquote>
<p>Yarn 是由 Facebook、Google、Exponent 和 Tilde 联合推出了一个新的 JS 包管理工具 。</p>
</blockquote>
<p>安装：<code>npm install -g yarn</code></p>
<p>执行 <code>yarn xxx</code> 命令报以下错误时：</p>
<p>操作以下步骤进行策略更改：</p>
<blockquote>
<p>1.使用管理员身份运行 <code>cmd</code> 或 <code>Power shell</code> 2.输入：<code>set-executionpolicy remotesigned</code> 3.输入<code>Y</code>，回车保存</p>
</blockquote>
<p>yarn 配置源：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 查询源</span><br><span class="line">yarn config get registry</span><br><span class="line"></span><br><span class="line">// 更换国内源</span><br><span class="line">yarn config <span class="built_in">set</span> registry https://registry.npmmirror.com</span><br><span class="line"></span><br><span class="line">// 恢复官方源</span><br><span class="line">yarn config <span class="built_in">set</span> registry https://registry.yarnpkg.com</span><br><span class="line"></span><br><span class="line">// 删除注册表</span><br><span class="line">yarn config delete registry</span><br></pre></td></tr></table></figure>

<p>npm 与 yarn 命令对比：<br>|npm 命令|yarn 命令|说明|<br>|-|-|-|<br>npm install | yarn install|安装依赖,安装时，如果 node_modules 中有相应的包则不会重新下载 –force 可以强制|<br>npm install [package@版本号] | yarn add [package@版本号]|指定版本安装一个包|<br>npm install [package] –save | yarn add [package]|安装一个包,–save 是 yarn 默认的|<br>npm install -g [package] | yarn global add [package@版本号]|指定版本安装一个包|<br>npm install –save-dev [package] | yarn add –dev [package]|安装包作为开发依赖项，简写<code>-D</code>|<br>npm uninstall [package] | yarn remove [package]|卸载一个包|<br>npm uninstall –save-dev [package] | yarn remove [package]|卸载开发依赖包|<br>npm update | yarn upgrade|更新的依赖关系|<br>npm update [package] | yarn upgrade [package]|更新包，npm 可以通过 ‘–save|–save-dev’ 指定升级哪类依赖|</p>
<h2 id="PNPM"><a href="#PNPM" class="headerlink" title="PNPM"></a>PNPM</h2><blockquote>
<p>pnpm(Performance npm，简称高性能 npm)的作者 Zoltan Kochan 发现 yarn 并没有打算去解决上述的这些问题，于是另起炉灶，写了全新的包管理器。</p>
</blockquote>
<p>pnpm 复刻了 npm 所有的命令，所以使用方法和 npm 一样，并且在安装目录结构上做了优化，特点是善用链接，且由于链接的优势，大多数情况下 pnpm 的安装速度比 yarn 和 npm 更快。</p>
<p>安装：<code>npm i pnpm -g</code></p>
<p>升级版本<code>pnpm add -g pnpm to update</code></p>
<p>设置源：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pnpm config get registry //查看源</span><br><span class="line">pnpm config <span class="built_in">set</span> registry https://registry.npmmirror.com //切换淘宝源</span><br></pre></td></tr></table></figure>

<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>在项目根目录安装依赖包 bar，而 bar 依赖了 foo。点开项目根目录的 node_modules，可以看到我们在项目中安装的 bar，以及.pnpm 文件夹。<br>那么 pnpm 是如何维护依赖的嵌套关系的呢？</p>
<p>首先在<code>.pnpm</code>文件夹以平铺的方式存储了项目中所有的依赖包，建立硬链接。命名的方式如下：</p>
<p><code>.pnpm/&lt;organization-name&gt;+&lt;package-name&gt;@&lt;version&gt;/node_modules/&lt;name&gt;// 组织名(若无会省略)+包名@版本号/node_modules/名称(项目名称)</code><br>其中.pnpm 中的包中的 node_modules 下面的包中的每个文件都是内容可寻址存储的硬链接。将 foo 和 bar 都放到 node_modules 文件夹，可以保证包能自行导入自己。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">node_modules</span><br><span class="line">└── .pnpm</span><br><span class="line"> ├── foo@1.0.0</span><br><span class="line"> │   └── node_modules</span><br><span class="line"> │       └── foo -&gt; &lt;store&gt;/bar 硬链接</span><br><span class="line"> │           ├── index.js</span><br><span class="line"> │           └── package.json</span><br><span class="line"> └── bar@1.0.0</span><br><span class="line">     └── node_modules</span><br><span class="line">         └── bar -&gt; &lt;store&gt;/bar 硬链接</span><br><span class="line">             ├── index.js</span><br><span class="line">             └── package.json</span><br></pre></td></tr></table></figure>

<p>建立符号链接，由于 bar 依赖了 foo，因此 foo 被符号链接到<a href="mailto:&#x62;&#x61;&#x72;&#x40;&#49;&#x2e;&#48;&#x2e;&#x30;">&#x62;&#x61;&#x72;&#x40;&#49;&#x2e;&#48;&#x2e;&#x30;</a>/node_modules 文件夹下，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">node_modules</span><br><span class="line">└── .pnpm</span><br><span class="line"> ├── foo@1.0.0</span><br><span class="line"> │   └── node_modules</span><br><span class="line"> │       └── foo -&gt; &lt;store&gt;/bar 硬链接</span><br><span class="line"> │           ├── index.js</span><br><span class="line"> │           └── package.json</span><br><span class="line"> └── bar@1.0.0</span><br><span class="line">     └── node_modules</span><br><span class="line">         └── bar -&gt; &lt;store&gt;/bar 硬链接</span><br><span class="line">         │    ├── index.js</span><br><span class="line">         │    └── package.json</span><br><span class="line">         └── foo -&gt; ../../bar@1.0.0/node_modules/bar 符号链接</span><br></pre></td></tr></table></figure>

<p>处理直接依赖，bar 被符号链接到根目录的 node_modules 文件夹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">node_modules</span><br><span class="line">├── bar -&gt; ./.pnpm/bar@1.0.0/node_modules/bar 符号链接</span><br><span class="line">└── .pnpm</span><br><span class="line"> ├── foo@1.0.0</span><br><span class="line"> │   └── node_modules</span><br><span class="line"> │       └── foo -&gt; &lt;store&gt;/bar 硬链接</span><br><span class="line"> │           ├── index.js</span><br><span class="line"> │           └── package.json</span><br><span class="line"> └── bar@1.0.0</span><br><span class="line">     └── node_modules</span><br><span class="line">         └── bar -&gt; &lt;store&gt;/bar 硬链接</span><br><span class="line">         │    ├── index.js</span><br><span class="line">         │    └── package.json</span><br><span class="line">         └── foo -&gt; ../../bar@1.0.0/node_modules/bar 符号链接</span><br></pre></td></tr></table></figure>

<p>在项目中我们引入 bar 的时候，会在当前项目根目录的 node_modules 找 bar，从 projectRoot/node_modules/bar 这个符号链接找到 bar 的真实文件 projectRoot/node_modules/.pnpm/<a href="mailto:&#x62;&#97;&#x72;&#64;&#49;&#46;&#x30;&#46;&#x30;">&#x62;&#97;&#x72;&#64;&#49;&#46;&#x30;&#46;&#x30;</a>/node_modules/bar（硬链接即可看做真实存在的文件）。<br>接着 bar 依赖了 foo，根据 node 的寻址机制，会从里到外找 foo，最后在这个路径 projectRoot/node_modules/.pnpm/<a href="mailto:&#98;&#97;&#114;&#64;&#x31;&#46;&#x30;&#x2e;&#x30;">&#98;&#97;&#114;&#64;&#x31;&#46;&#x30;&#x2e;&#x30;</a>/node_modules/foo 找到了，这个是一个符号链接，会定位到 projectRoot/node_modules/.pnpm/<a href="mailto:&#102;&#x6f;&#111;&#x40;&#x31;&#x2e;&#48;&#x2e;&#x30;">&#102;&#x6f;&#111;&#x40;&#x31;&#x2e;&#48;&#x2e;&#x30;</a></p>
<h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><ul>
<li><p>解决了幽灵依赖的问题<br>yarn 和 npm 中的幽灵依赖：由于在 yarn 或 npm 中采用扁平化的安装包的方式，即所有的包（包括依赖的依赖）都被提升到了项目根目录中的 node_modules 中，那么项目中可以直接引用到不在 package.json 中声明的包，那么在包更新的时候，可能会导致问题。<br>而 pnmp 中的项目根目录的 node_modules 中只有项目直接依赖的包，所以不会有这个问题。</p>
</li>
<li><p>路径过长的问题<br>在 npm@3 之前，npm 采用的嵌套结构管理包，node_modules 结构是干净、可预测的，因为 node_modules 中的每个依赖项都有自己的 node_modules 文件夹。但是这样的管理方式会导致路径过程超出 window 的限制。<br>在 npm@3 和 yarn 中，采用了扁平化结构管理包（解决了路径过长的问题，导致了幽灵依赖的问题）。<br>pnpm 利用符号链接解决了这个问题。<br>继续上面的<br>添加<a href="mailto:&#x71;&#97;&#x72;&#x40;&#x32;&#x2e;&#x30;&#46;&#48;">&#x71;&#97;&#x72;&#x40;&#x32;&#x2e;&#x30;&#46;&#48;</a>作为 foo 和 bar 的依赖项,可以看到我们目录深度没有改变，但却表达了嵌套的包依赖关系。</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">node_modules</span><br><span class="line">├── bar -&gt; ./.pnpm/bar@1.0.0/node_modules/bar 符号链接</span><br><span class="line">└── .pnpm</span><br><span class="line">    ├── foo@1.0.0</span><br><span class="line">    │   └── node_modules</span><br><span class="line">    │       └── foo -&gt; &lt;store&gt;/bar 硬链接</span><br><span class="line">    │           ├── index.js</span><br><span class="line">    │           └── package.json</span><br><span class="line">    │       └── qar -&gt; ../../qar@2.0.0/node_modules/qar 符号链接</span><br><span class="line">    └── bar@1.0.0</span><br><span class="line">    │   └── node_modules</span><br><span class="line">    │       └── bar -&gt; &lt;store&gt;/bar 硬链接</span><br><span class="line">    │       │    ├── index.js</span><br><span class="line">    │       │    └── package.json</span><br><span class="line">    │        └── foo -&gt; ../../bar@1.0.0/node_modules/bar 符号链接</span><br><span class="line">    │       └── qar -&gt; ../../qar@2.0.0/node_modules/qar 符号链接</span><br><span class="line">    └── qar@2.0.0</span><br><span class="line">            └── node_modules</span><br><span class="line">                └── qar -&gt; &lt;store&gt;/qar</span><br></pre></td></tr></table></figure>

<ul>
<li>占用更小的内存，下载速度更快<br>使用 npm 时，依赖每次被不同的项目使用，都会重复安装一次。 而在使用 pnpm 时，依赖会被存储在内容可寻址的存储中，所以：</li>
</ul>
<p>如果你用到了某依赖项的不同版本，只会将不同版本间有差异的文件添加到仓库。 例如，如果某个包有 100 个文件，而它的新版本只改变了其中 1 个文件。那么 pnpm update 时只会向存储中心额外添加 1 个新文件，而不会因为仅仅一个文件的改变复制整新版本包的内容。<br>所有文件都会存储在硬盘上的某一位置。 当软件包被被安装时，包里的文件会硬链接到这一位置，而不会占用额外的磁盘空间。 这允许你跨项目地共享同一版本的依赖。<br>因此，您在磁盘上节省了大量空间，这与项目和依赖项的数量成正比，并且安装速度要快得多！</p>
<h2 id="CNPM"><a href="#CNPM" class="headerlink" title="CNPM"></a>CNPM</h2><p>cnpm 是个中国版的 npm，是淘宝定制的 cnpm (gzip 压缩支持) 命令行工具代替默认的 npm</p>
<h2 id="npm-vs-yarn-vs-pnpm"><a href="#npm-vs-yarn-vs-pnpm" class="headerlink" title="npm vs yarn vs pnpm"></a>npm vs yarn vs pnpm</h2><h3 id="npm-v1-v2"><a href="#npm-v1-v2" class="headerlink" title="npm v1-v2"></a>npm v1-v2</h3><p>初代 npm(Node.js Package Manager)随着 Node.js 的发布出现了。</p>
<p>它的文件结构是嵌套的,这会导致 3 个问题：</p>
<p>1、node_modules 体积过大(大量重复的包被安装)</p>
<p>2、node_modules 嵌套层级过深(会导致文件路径过长的问题)</p>
<p>3、模块实例不能共享</p>
<h3 id="yarn-amp-npm-v3"><a href="#yarn-amp-npm-v3" class="headerlink" title="yarn &amp; npm v3"></a>yarn &amp; npm v3</h3><p>这个版本 yarn 和 npm v3 带来了扁平化依赖管理：<br>扁平化处理时，比如安装 A，A 依赖 B 和 C，C 依赖 D 和 E，就把 A~E 全部放到 node_modules 目录下，从而解决上个版本中 node_modules 嵌套层级过深的问题。</p>
<p>在 install 安装时，会不停的往上级 node_modules 中寻找，如果找到同样的包，就不再重复安装，从而解决了大量包被重复安装的问题。但是扁平化带来了新的问题：</p>
<ol>
<li>依赖结构的不确定性</li>
<li>扁平化算法本身复杂性很高，耗时较长</li>
<li>项目中仍然可以非法访问没有声明过依赖的包</li>
</ol>
<p> 对于问题 1，比如 B 和 C 都依赖了 F，但是依赖的 F 版本不一样,依赖结构的不确定性表现是扁平化的结果不确定，以下 2 种情况都有可能，取决于 package.json 中 B 和 C 的位置。于是出现 yarn.lock(npm5 才有 package-lock.json)，来保证 install 后产生确定的依赖结构。但这并不能完全解决问题，node_modules 中依然存在各种不同版本的 F，而这可能导致各种情况的编译报错，以及安装满，占磁盘空间。</p>
<p>对于问题 3，package.json 中我们只声明了 A，B<del>F 都是因为扁平化处理才放到和 A 同级的 node_modules 下，理论上在项目中写代码时只可以使用 A，但实际上 B</del>F 也可以使用，由于扁平化将没有直接依赖的包提升到 node_modules 一级目录，Node.js 没有校验是否有直接依赖，所以项目中可以非法访问没有声明过依赖的包。这会产生两个问题：B~F 中的包升级后，项目可能出问题和额外的管理成本(比如协作时别人运行一次 npm install 后项目依旧跑不起来)</p>
<h3 id="pnpm"><a href="#pnpm" class="headerlink" title="pnpm"></a>pnpm</h3><p>pnpm 复刻了 npm 所有的命令，所以使用方法和 npm 一样，并且在安装目录结构上做了优化，特点是善用链接，且由于链接的优势，大多数情况下 pnpm 的安装速度比 yarn 和 npm 更快。</p>
<p>比如安装 A，A 依赖了 B：</p>
<ol>
<li><p>安装依赖<br>A 和 B 一起放到.pnpm 中(和上面相比，这里没有耗时的扁平化算法)。<br>另外<a href="mailto:&#x41;&#x40;&#49;&#x2e;&#x30;&#x2e;&#x30;">&#x41;&#x40;&#49;&#x2e;&#x30;&#x2e;&#x30;</a>下面是 node_modules，然后才是 A，这样做有两点好处：</p>
<ul>
<li>允许包引用自身</li>
<li>把包和它的依赖摊平，避免循环结构</li>
</ul>
</li>
<li><p>处理间接依赖<br>A 平级目录创建 B，B 指向<a href="mailto:&#66;&#64;&#49;&#46;&#48;&#x2e;&#48;">&#66;&#64;&#49;&#46;&#48;&#x2e;&#48;</a>下面的 B。</p>
</li>
<li><p>处理直接依赖<br>顶层 node_modules 目录下创建 A，指向<a href="mailto:&#65;&#x40;&#x31;&#46;&#x30;&#x2e;&#48;">&#65;&#x40;&#x31;&#46;&#x30;&#x2e;&#48;</a>下的 A。</p>
</li>
</ol>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li><p>如果你想更快的速度，更小的空间，你应该选择 pnpm;</p>
</li>
<li><p>如果你要用 Monorepo(monolithic repository)是一种项目架构,简单的来说:一个仓库内包含多个开发项目(模块,包)，你可以用 yarn 或 pnpm;</p>
</li>
<li><p>如果是 node 项目，你应该用 npm，因为这是 node 官方推荐的，而且 yarn 不支持 node5+;</p>
</li>
<li><p>对于 npm 项目，如果你担心项目的安全性，你可以考虑用 yarn 替换 npm。</p>
</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag"># 前端</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/06/01/20-00-00/" rel="prev" title="TypeScript">
      <i class="fa fa-chevron-left"></i> TypeScript
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/08/11/20-22-22/" rel="next" title="nginx">
      nginx <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#NPM"><span class="nav-number">1.</span> <span class="nav-text">NPM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%EF%BC%8C%E5%8C%85%E7%9A%84%E5%AE%89%E8%A3%85-%E6%9B%B4%E6%96%B0-%E5%8D%B8%E8%BD%BD"><span class="nav-number">1.1.</span> <span class="nav-text">一，包的安装&#x2F;更新&#x2F;卸载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%EF%BC%8C%E4%BF%A1%E6%81%AF%E6%9F%A5%E7%9C%8B"><span class="nav-number">1.2.</span> <span class="nav-text">二，信息查看</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89-%E5%85%B6%E5%AE%83"><span class="nav-number">1.3.</span> <span class="nav-text">三, 其它</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B%EF%BC%8C%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8C%85"><span class="nav-number">1.4.</span> <span class="nav-text">四，发布自己的包</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E8%BF%9B%E5%85%A5%E8%A6%81%E5%8F%91%E5%B8%83%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%A0%B9%E7%9B%AE%E5%BD%95%EF%BC%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%BA-npm-%E5%8C%85"><span class="nav-number">1.4.1.</span> <span class="nav-text">第一步：进入要发布的项目根目录，初始化为 npm 包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E3%80%81%E6%B3%A8%E5%86%8C-npm-%E7%94%A8%E6%88%B7%EF%BC%8C%E6%9C%89%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95-%E6%B3%A8%E5%86%8C-npm-%E7%94%A8%E6%88%B7%EF%BC%8C%E6%9C%89%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95"><span class="nav-number">1.4.2.</span> <span class="nav-text">第二步、注册 npm 用户，有两种方法 注册 npm 用户，有两种方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%E3%80%81%E8%B4%A6%E5%8F%B7%E7%99%BB%E5%BD%95"><span class="nav-number">1.4.3.</span> <span class="nav-text">第三步、账号登录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5%E3%80%81%E5%8F%91%E5%B8%83%E5%8C%85%EF%BC%8C%E4%B8%8A%E4%BC%A0%E5%88%B0-npm-%E5%8C%85%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">1.4.4.</span> <span class="nav-text">第四步、发布包，上传到 npm 包服务器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%94%EF%BC%8C%E6%9B%B4%E6%96%B0%E4%B8%80%E4%B8%AA%E5%B7%B2%E7%BB%8F%E5%8F%91%E5%B8%83%E7%9A%84%E5%8C%85"><span class="nav-number">1.5.</span> <span class="nav-text">五，更新一个已经发布的包</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%E3%80%81%E4%BF%AE%E6%94%B9%E5%8C%85%E7%9A%84%E7%89%88%E6%9C%AC"><span class="nav-number">1.5.1.</span> <span class="nav-text">第一步、修改包的版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E3%80%81%E9%87%8D%E6%96%B0%E5%8F%91%E5%B8%83%E5%8C%85"><span class="nav-number">1.5.2.</span> <span class="nav-text">第二步、重新发布包</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E5%88%A0%E9%99%A4%E5%8C%85"><span class="nav-number">1.6.</span> <span class="nav-text">六、删除包</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#YARN"><span class="nav-number">2.</span> <span class="nav-text">YARN</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PNPM"><span class="nav-number">3.</span> <span class="nav-text">PNPM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86"><span class="nav-number">3.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8A%BF"><span class="nav-number">3.2.</span> <span class="nav-text">优势</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CNPM"><span class="nav-number">4.</span> <span class="nav-text">CNPM</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#npm-vs-yarn-vs-pnpm"><span class="nav-number">5.</span> <span class="nav-text">npm vs yarn vs pnpm</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#npm-v1-v2"><span class="nav-number">5.1.</span> <span class="nav-text">npm v1-v2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#yarn-amp-npm-v3"><span class="nav-number">5.2.</span> <span class="nav-text">yarn &amp; npm v3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pnpm"><span class="nav-number">5.3.</span> <span class="nav-text">pnpm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">5.4.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">KK</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">59</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/a913481180" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;a913481180" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:kangkanghuang@foxmail.com" title="E-Mail → mailto:kangkanghuang@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.baidu.com/" title="http:&#x2F;&#x2F;www.baidu.com">百度</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">KK</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
